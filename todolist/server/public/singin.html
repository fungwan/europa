<!DOCTYPE html>

<script src="js/jquery-1.11.1.min.js"></script>
<script src="libs/base64.min.js"></script>
<script src="controller/c_tools_apiServices.js"></script>
<script>

    var storage = window.localStorage;
    if(window.localStorage){
        var request = new ApiService();
        var url = '/api/loginSessions';
        request.get(url,
                function(err, result) {
                    if (err === null) {
                        //location to index
                        console.log(result.content);
                        document.location = './index.html'
                    }
                }
        );

    }else{
        (function(){ alert('This browser does NOT support localStorage');return;})();
    }

</script>

<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<input type="text" id="username" ><input type="password" id="password" >
<button id="login-btn">登录 &nbsp;
</button>
</body>
<script src="libs/md5.js"></script>
</html>

<script>

    if(window.localStorage){
        var storage = window.localStorage;

    }else{
        alert('This browser does NOT support localStorage');
        //return;
    }

    $("#login-btn").bind("click", function () {
         //alert('got it');


        if(!$("#username").val()){
            alert('username cannot be null');
            return;
        }

        var hash = '';
        hash = hex_md5($("#password").val());

        $.post("/api/loginSessions",{name:$("#username").val(),
                    password:hash},
                function (data) {
                    // window.location.href="/inbox.html";
                    console.log(typeof data);//data is object
                    if(data.result === 'ok'){
                        var tokenInfo = data.content;
                        storage.setItem("tokenInfo",JSON.stringify(tokenInfo));
                        document.location = './inbox.html'
                    }else{
                        alert('password was wrong...');
                    }
                });


    });

</script>
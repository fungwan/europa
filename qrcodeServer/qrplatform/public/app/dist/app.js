window.APP=angular.module("APP",["ngSanitize","ngRoute","infinite-scroll","ngAnimate","cp.ngConfirm"]),window.APP.run(["$http","$ngConfirmDefaults",function(t,e){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",e.useBootstrap=!1}]),window.APP.controller("navbarCtrl",["$scope","PostService","CheckLoginService","UtilService","MessageService",function(t,e,i,o,r){t.menuItems=[{title:"首页",isLink:!1,href:"/enterprise/do.html"},{title:"营销方案",isLink:!1,href:"/enterprise/solution.html"},{title:"商品管理",isLink:!1,href:"/enterprise/manage.mcdqr.html",subMenus:[{title:"商品分类管理",href:"/app/#/commondity/category"},{title:"商品管理",href:"/app/#/commondity/commondity"}]},{title:"数据分析",isLink:!1,href:"/enterprise/analysis.html",subMenus:[{title:"活动分析",href:"/app/#/analysis/activity"},{title:"会员人数分析",href:"/app/#/analysis/member"},{title:"订单分析",href:"/app/#/analysis/order"},{title:"积分分析",href:"/app/#/analysis/point"}]},{title:"消费者管理",isLink:!1,href:"/enterprise/managehome.html",subMenus:[{title:"消费者分组管理",href:"/app/#/customer/group"},{title:"消费者管理",href:"/app/#/customer/customer"}]},{title:"商城管理",isLink:!1,href:"/app/#/mall/manage"},{title:"促销信息管理",isLink:!1,href:"/app/#/commondity/sale",subMenus:[{title:"促销文章管理",href:"/app/#/commondity/sale"},{title:"广告位管理",href:"/app/#/commondity/ad"}]},{title:"企业信息",isLink:!1,href:"/enterprise/account.html"},{title:"关于我们",isLink:!0,href:"http://erathink.com/"}],t.clickMenu=function(e){e.isLink||(void 0!=e.subMenus?t.openedMenu==e?t.openedMenu=null:t.openedMenu=e:(t.selectedMenu=e,t.selectedSubMenu=null))},t.clickSubMenu=function(e,i,o){e.stopPropagation(),t.selectedMenu=o,t.selectedSubMenu=i},i.userPromise.then(function(e){t.user=e}),t.logout=function(){o.startLoading(),e.request("/logout").then(function(t){window.location.href="/"}).catch(function(e){r.error(t,"登出失败，请稍后重试！")}).finally(function(){o.stopLoading()})}}]),window.APP.filter("commondityFilter",function(){return function(t){return t=t||"",1==t?"已上架":0==t?"已下架":"未知"}}),window.APP.filter("commondityTitleFilter",function(){return function(t){return t=t||"",1==t?"点击下架":0==t?"点击上架":"未知状态"}}),window.APP.filter("qrcodeProgressFilter",function(){return function(t){return t=t||"0",100*parseFloat(t).toFixed(2)+"%"}}),window.APP.filter("commonditySaleState",function(){return function(t){return t=t||"",0==t?"未发布":1==t?"已发布":"已停用"}}),window.APP.filter("timFmart",function(){return function(t){return new Date(t).toLocaleString().replace(/:\d{1,2}$/," ")}}),window.APP.filter("timFmart10",function(){return function(t){return new String(t).slice(0,19).replace("T"," ")}}),window.APP.filter("forstate",function(){return function(t){return t="sell"==t?"已上架":"已下架"}}),window.APP.filter("forstatef",function(){return function(t){return t="sell"==t?"下架":"上架"}}),window.APP.filter("timFmartm",function(){return function(t){return t?new Date(parseInt(t)).toLocaleString().replace(/年|月/g,"-").replace(/日/g," "):""}}),window.APP.filter("timFmartm1000",function(){return function(t){return new Date(1e3*parseInt(t)).toLocaleString().replace(/年|月/g,"-").replace(/日/g," ")}}),window.APP.filter("state",function(){return function(t){return t="0"==t?"待审核":"1"==t?"审核通过":"审核未通过"}}),window.APP.filter("timF",function(){return function(t){var e=t.getFullYear(),i=t.getMonth()+1;i=i<10?"0"+i:i;var o=t.getDate();o=o<10?"0"+o:o;var r=t.getHours(),n=t.getMinutes();return n=n<10?"0"+n:n,e+"-"+i+"-"+o+" "+r+":"+n}}),window.APP.filter("orderStateFilter",function(){return function(t){var e;switch(t){case"0":e="待发货";break;case"1":e="待付款";break;case"2":e="待收货";break;case"3":e="已完成";break;case"4":e="已取消";break;case"5":e="退货审核中";break;case"6":e="换货审核中";break;case"7":e="退货中";break;case"8":e="换货中";break;case"100":e="已关闭";break;default:e=""}return e}}),window.APP.filter("articleAdState",function(){return function(t){var e;switch(t){case"focus":e="关注广告";break;case"shop1":e="首页1号位";break;case"shop2":e="首页2号位";break;case"userinfo1":e="用户信息页广告";break;case"clube_news":e="轮播新闻";break;case"clube_hot":e="热销产品";break;case"clube_onsale":e="专享活动";break;default:e="未设置"}return e}}),window.APP.constant("HostConfig",{primary:"/",preview:"/",download:"http://wx.51s.co:3002/",mall:{productlistimageurl:"http://om5zaeh9b.bkt.clouddn.com/",productlistimagestyle:"list",productevalurl:"",productevalstyle:"",productimageurl:"http://om5zaeh9b.bkt.clouddn.com/",productimagestyle:"info",productshopcarimageurl:"http://om5zaeh9b.bkt.clouddn.com/",productshopcarimagestyle:"shopcart",articleUrl:"http://wx.51s.co/club/article?id=",articleimageurl:"http://om5zzdb7m.bkt.clouddn.com/",articleimagestyle:"title",articleimagesmallstyle:"titlesmall",articleimage60style:"title60"},qiniu:{ACCESS_KEY:"Fgzgpew-8fnEcZh-4D1VU5qhwD5cMoZvueekz60e",SECRET_KEY:"ZCSJU-m8ur-Q1IUrCnzfCuEqQ9mkBo70ZguuVAIr",product:"product",article:"article"},adtype:{focus:{key:"focus",title:"关注广告"},shop1:{key:"shop1",title:"商城首页1号位"},shop2:{key:"shop2",title:"商城首页2号位"},userinfo1:{key:"userinfo1",title:"用户信息页广告"},clube_news:{key:"clube_news",title:"会员专区轮播新闻"},clube_hot:{key:"clube_hot",title:"会员专区热销商品"},clube_onsale:{key:"clube_onsale",title:"会员专享活动"}}}),window.APP.config(["$routeProvider","$locationProvider",function(t,e){t.when("/customer/group",{templateUrl:"views/templates/customer.group.html",controller:"customerGroupCtrl"}).when("/customer/customer",{templateUrl:"views/templates/customer.customer.html",controller:"customerCtrl"}).when("/commondity/category",{templateUrl:"views/templates/commondity.category.html",controller:"commondityCategoryCtrl"}).when("/commondity/commondity",{templateUrl:"views/templates/commondity.commondity.html",controller:"commondityCtrl"}).when("/commondity/sale",{templateUrl:"views/templates/commondity.sale.html",controller:"commonditySaleCtrl"}).when("/commondity/ad",{templateUrl:"views/templates/advertise/commondity.ad.html",controller:"commondityAdCtrl"}).when("/mall/manage",{templateUrl:"views/templates/mall/mall.manage.html",controller:"mallManage"}).when("/analysis/activity",{templateUrl:"views/templates/analysis/activity.html",controller:"activityCtrl"}).when("/analysis/member",{templateUrl:"views/templates/analysis/member.html",controller:"analysisMemberCtrl"}).when("/analysis/order",{templateUrl:"views/templates/analysis/order.html",controller:"analysisOrderCtrl"}).when("/analysis/point",{templateUrl:"views/templates/analysis/point.html",controller:"analysisPointCtrl"}).otherwise({redirectTo:"/customer/group"})}]),window.APP.directive("mPagination",function(){return{restrict:"EA",scope:{mRecordTotal:"=",mPageNum:"=",mPageCount:"=",mPageClick:"&",mGoPage:"&"},replace:!0,templateUrl:"views/directiveTemplates/pagination.html",controller:["$scope","$element","$attrs","$transclude",function(t,e,i,o){!function(){var e=1,i=5,o=parseInt(i/2),r=t.mPageNum,n=t.mPageCount;r>o&&(e=r-o,i=r+o),i>n&&(e=n-4,i=n),e<1&&(e=1),t.showPageNums=[];for(var s=e;s<=i;s++)t.showPageNums.push(s)}(),t.goPage=function(e){0!=e&&e!=t.mPageCount+1&&e!=t.pageNum&&t.$emit("goPage",e)}}]}}),window.APP.directive("mDropdown",function(){return{restrict:"EA",replace:!0,transclude:{text:"mDropdownText",menu:"mDropdownMenu"},templateUrl:"views/directiveTemplates/dropdown.html",controller:["$scope","$element","$attrs","$transclude",function(t,e,i,o){var r=$(".container");t.showDropDownMenu=function(t){var e=$(t.currentTarget);if(e.hasClass("show"))e.removeClass("show"),r.css("cssText","height: auto !important");else{e.addClass("show"),$dropdownMenu=e.find(".dropdown-menu");var i=$dropdownMenu.outerHeight()+$dropdownMenu.offset().top-r.height();if(i>0){console.log(i);var o=r.height()+i;console.log(o),r.css("cssText","height: "+o+"px !important")}}},t.closeDropDownMenu=function(t){$(t.currentTarget).removeClass("show")}}]}}),window.APP.directive("mMessage",["$timeout","$animate",function(t,e){return{restrict:"EA",replace:!0,scope:{mImgSrc:"@",mMessageContent:"@",mMessageClose:"@",mDuration:"@"},templateUrl:"views/directiveTemplates/message.html",link:function(i,o,r,n){var s=o.parent();e.enter(o,s,s.children(":last")),i.showClose=function(){return"true"===i.mMessageClose},i.close=function(){e.leave(o)};var a=parseInt(i.mDuration);if(a>0){t(function(){i.close()},a)}}}}]),window.APP.directive("mTab",function(){return{restrict:"EA",replace:!0,scope:{mTabItems:"="},templateUrl:"views/directiveTemplates/analysis.tab.html",controller:["$scope","$element","$attrs","$transclude",function(t,e,i,o){t.selectedItem=t.mTabItems[0],t.selectItem=function(e){t.selectedItem=e}}]}}),window.APP.directive("mConfirm",function(){return{restrict:"EA",replace:!0,templateUrl:"views/directiveTemplates/confirm.html",controller:["$scope","$element","$attrs","$transclude",function(t,e,i,o){t.confirmClose=function(){$(".confirm").remove()},t.confirm=function(){t.confirmClose(),t.confirmSure()}}]}}),window.APP.directive("mViewOptGroup",function(){return{restrict:"EA",replace:!0,transclude:{form:"mForm",action:"mAction"},templateUrl:"views/directiveTemplates/viewOptGroup.html",controller:["$scope","$element","$attrs","$transclude",function(t,e,i,o){t.isCollapse=!1,t.toggleCollapse=function(){t.isCollapse=!t.isCollapse}}]}}),window.APP.factory("UserService",["$http",function(t){return{login:function(e){t({method:"POST",url:"/login",data:e}).success(function(t){t&&t.data&&console.info("login success")})}}}]),window.APP.factory("CheckLoginService",["$q","$http",function(t,e){var i=function(){var i=t.defer();return e({method:"POST",url:"/checklogin"}).success(function(t){t.error?window.location.href="/":i.resolve(t.data)}).error(function(t){window.location.href="/"}),i.promise};return{checkLogin:i,userPromise:i()}}]),window.APP.factory("ConfirmService",["$rootScope","$compile",function(t,e){return{confirm:function(i,o){t.mConfirmContent=i,t.confirmSure=o,$body=$("body"),$body.append(e("<div m-Confirm></div>")(t))},close:function(){$(".confirm").remove()}}}]),window.APP.factory("ValiService",["$rootScope","$compile","MessageService",function(t,e,i){return{Notempty:function(t){return!!t},isUrl:function(t){return!!/^((ht|f)tps?):\/\/[\w\-]+(\.[\w\-]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?$/.test(t)},upIntNum:function(t){return!!/^[1-9]*[1-9][0-9]*$/.test(t)},check:function(t){t&&t.error&&"unlogin"==t.error.code&&i.uniqueError("用户未登录，请前去登录！").then(function(){window.location.href="/"})},isChinese:function(t){return!!/.*[\u4e00-\u9fa5].*/.test(t)}}}]),window.APP.factory("MessageService",["$rootScope","$compile","$q","$timeout","$ngConfirm",function(t,e,i,o,r){var n=$("body"),s={showClose:!1,message:"",duration:3e3,type:"info"},a={success:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQwcHgiIGhlaWdodD0iNDBweCIgdmlld0JveD0iMCAwIDQwIDQwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCAzOS4xICgzMTcyMCkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+aWNvbl9zdWNjZXNzPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+PC9kZWZzPgogICAgPGcgaWQ9IkVsZW1lbnQtZ3VpZGVsaW5lLXYwLjIuNCIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9Ik1lc3NhZ2UiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC02MC4wMDAwMDAsIC0yMTIuMDAwMDAwKSI+CiAgICAgICAgICAgIDxnIGlkPSLluKblgL7lkJFf5L+h5oGvIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2MC4wMDAwMDAsIDIxMi4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxnIGlkPSJSZWN0YW5nbGUtMiI+CiAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Imljb25fc3VjY2VzcyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtMiIgZmlsbD0iIzEzQ0U2NiIgeD0iMCIgeT0iMCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIj48L3JlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0yNy44MjU1ODE0LDE3LjE0ODQzNTcgTDE5LjAxNzQ0LDI1LjgyODEyMTMgQzE4LjkwMTE2MDksMjUuOTQyNzA4MyAxOC43NjU1MDMzLDI2IDE4LjYxMDQ2NywyNiBDMTguNDU1NDI3LDI2IDE4LjMxOTc2OTMsMjUuOTQyNzA4MyAxOC4yMDM0ODY1LDI1LjgyODEyMTMgTDE4LjAyOTA3MTYsMjUuNjU2MjUgTDEzLjE3NDQxODYsMjAuODQzNzUgQzEzLjA1ODEzOTUsMjAuNzI5MTYzIDEzLDIwLjU5NTQ4MzcgMTMsMjAuNDQyNzA0NyBDMTMsMjAuMjg5OTI5MyAxMy4wNTgxMzk1LDIwLjE1NjI1IDEzLjE3NDQxODYsMjAuMDQxNjY2NyBMMTQuMzY2Mjc3MiwxOC44NjcxODU3IEMxNC40ODI1NiwxOC43NTI2MDIzIDE0LjYxODIxNzcsMTguNjk1MzEwNyAxNC43NzMyNTc3LDE4LjY5NTMxMDcgQzE0LjkyODI5NCwxOC42OTUzMTA3IDE1LjA2Mzk1MTYsMTguNzUyNjAyMyAxNS4xODAyMzA3LDE4Ljg2NzE4NTcgTDE4LjYxMDQ2NywyMi4yNzYwMzggTDI1LjgxOTc2OTMsMTUuMTcxODcxMyBDMjUuOTM2MDQ4NCwxNS4wNTcyODggMjYuMDcxNzA2LDE1IDI2LjIyNjc0MjMsMTUgQzI2LjM4MTc4MjMsMTUgMjYuNTE3NDQsMTUuMDU3Mjg4IDI2LjYzMzcyMjgsMTUuMTcxODcxMyBMMjcuODI1NTgxNCwxNi4zNDYzNTIzIEMyNy45NDE4NjA1LDE2LjQ2MDkzNTcgMjgsMTYuNTk0NjE1IDI4LDE2Ljc0NzM5NCBDMjgsMTYuOTAwMTczIDI3Ljk0MTg2MDUsMTcuMDMzODUyMyAyNy44MjU1ODE0LDE3LjE0ODQzNTcgTDI3LjgyNTU4MTQsMTcuMTQ4NDM1NyBaIiBpZD0iUGF0aCIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+",info:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQwcHgiIGhlaWdodD0iNDBweCIgdmlld0JveD0iMCAwIDQwIDQwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCAzOS4xICgzMTcyMCkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+aWNvbl9pbmZvPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+PC9kZWZzPgogICAgPGcgaWQ9IkVsZW1lbnQtZ3VpZGVsaW5lLXYwLjIuNCIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9Ik1lc3NhZ2UiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC02MC4wMDAwMDAsIC0xNTIuMDAwMDAwKSI+CiAgICAgICAgICAgIDxnIGlkPSLluKblgL7lkJFf5L+h5oGvIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg2MC4wMDAwMDAsIDE1Mi4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxnIGlkPSJSZWN0YW5nbGUtMiI+CiAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Imljb25faW5mbyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtMiIgZmlsbD0iIzUwQkZGRiIgeD0iMCIgeT0iMCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIj48L3JlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0yMS42MTUzODQ2LDI2LjU0MzIwOTkgQzIxLjYxNTM4NDYsMjYuOTQ3ODc1MSAyMS40NTgzMzQ4LDI3LjI5MTgzNjggMjEuMTQ0MjMwOCwyNy41NzUxMDI5IEMyMC44MzAxMjY4LDI3Ljg1ODM2ODkgMjAuNDQ4NzE5NCwyOCAyMCwyOCBDMTkuNTUxMjgwNiwyOCAxOS4xNjk4NzMyLDI3Ljg1ODM2ODkgMTguODU1NzY5MiwyNy41NzUxMDI5IEMxOC41NDE2NjUyLDI3LjI5MTgzNjggMTguMzg0NjE1NCwyNi45NDc4NzUxIDE4LjM4NDYxNTQsMjYuNTQzMjA5OSBMMTguMzg0NjE1NCwxOS43NDQ4NTYgQzE4LjM4NDYxNTQsMTkuMzQwMTkwNyAxOC41NDE2NjUyLDE4Ljk5NjIyOSAxOC44NTU3NjkyLDE4LjcxMjk2MyBDMTkuMTY5ODczMiwxOC40Mjk2OTY5IDE5LjU1MTI4MDYsMTguMjg4MDY1OCAyMCwxOC4yODgwNjU4IEMyMC40NDg3MTk0LDE4LjI4ODA2NTggMjAuODMwMTI2OCwxOC40Mjk2OTY5IDIxLjE0NDIzMDgsMTguNzEyOTYzIEMyMS40NTgzMzQ4LDE4Ljk5NjIyOSAyMS42MTUzODQ2LDE5LjM0MDE5MDcgMjEuNjE1Mzg0NiwxOS43NDQ4NTYgTDIxLjYxNTM4NDYsMjYuNTQzMjA5OSBaIE0yMCwxNS44MDQyOTgxIEMxOS40NDQ0NDI3LDE1LjgwNDI5ODEgMTguOTcyMjI0LDE1LjYxOTM2ODcgMTguNTgzMzMzMywxNS4yNDk1MDQ2IEMxOC4xOTQ0NDI3LDE0Ljg3OTY0MDYgMTgsMTQuNDMwNTI1NSAxOCwxMy45MDIxNDkxIEMxOCwxMy4zNzM3NzI2IDE4LjE5NDQ0MjcsMTIuOTI0NjU3NSAxOC41ODMzMzMzLDEyLjU1NDc5MzUgQzE4Ljk3MjIyNCwxMi4xODQ5Mjk1IDE5LjQ0NDQ0MjcsMTIgMjAsMTIgQzIwLjU1NTU1NzMsMTIgMjEuMDI3Nzc2LDEyLjE4NDkyOTUgMjEuNDE2NjY2NywxMi41NTQ3OTM1IEMyMS44MDU1NTczLDEyLjkyNDY1NzUgMjIsMTMuMzczNzcyNiAyMiwxMy45MDIxNDkxIEMyMiwxNC40MzA1MjU1IDIxLjgwNTU1NzMsMTQuODc5NjQwNiAyMS40MTY2NjY3LDE1LjI0OTUwNDYgQzIxLjAyNzc3NiwxNS42MTkzNjg3IDIwLjU1NTU1NzMsMTUuODA0Mjk4MSAyMCwxNS44MDQyOTgxIFoiIGlkPSJDb21iaW5lZC1TaGFwZSIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+",warning:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQwcHgiIGhlaWdodD0iNDBweCIgdmlld0JveD0iMCAwIDQwIDQwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCAzOS4xICgzMTcyMCkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+aWNvbl93YXJuaW5nPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+PC9kZWZzPgogICAgPGcgaWQ9IlBhZ2UtMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9Ik1lc3NhZ2UiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC02MC4wMDAwMDAsIC0yNzIuMDAwMDAwKSI+CiAgICAgICAgICAgIDxnIGlkPSLluKblgL7lkJFf5L+h5oGvLWNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYwLjAwMDAwMCwgMjcyLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPGcgaWQ9IlJlY3RhbmdsZS0yIj4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iaWNvbl93YXJuaW5nIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHJlY3QgaWQ9IlJlY3RhbmdsZS0yIiBmaWxsPSIjRjdCQTJBIiB4PSIwIiB5PSIwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiPjwvcmVjdD4KICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTIxLjYxNTM4NDYsMjYuNTQzMjA5OSBDMjEuNjE1Mzg0NiwyNi45NDc4NzUxIDIxLjQ1ODMzNDgsMjcuMjkxODM2OCAyMS4xNDQyMzA4LDI3LjU3NTEwMjkgQzIwLjgzMDEyNjgsMjcuODU4MzY4OSAyMC40NDg3MTk0LDI4IDIwLDI4IEMxOS41NTEyODA2LDI4IDE5LjE2OTg3MzIsMjcuODU4MzY4OSAxOC44NTU3NjkyLDI3LjU3NTEwMjkgQzE4LjU0MTY2NTIsMjcuMjkxODM2OCAxOC4zODQ2MTU0LDI2Ljk0Nzg3NTEgMTguMzg0NjE1NCwyNi41NDMyMDk5IEwxOC4zODQ2MTU0LDE5Ljc0NDg1NiBDMTguMzg0NjE1NCwxOS4zNDAxOTA3IDE4LjU0MTY2NTIsMTguOTk2MjI5IDE4Ljg1NTc2OTIsMTguNzEyOTYzIEMxOS4xNjk4NzMyLDE4LjQyOTY5NjkgMTkuNTUxMjgwNiwxOC4yODgwNjU4IDIwLDE4LjI4ODA2NTggQzIwLjQ0ODcxOTQsMTguMjg4MDY1OCAyMC44MzAxMjY4LDE4LjQyOTY5NjkgMjEuMTQ0MjMwOCwxOC43MTI5NjMgQzIxLjQ1ODMzNDgsMTguOTk2MjI5IDIxLjYxNTM4NDYsMTkuMzQwMTkwNyAyMS42MTUzODQ2LDE5Ljc0NDg1NiBMMjEuNjE1Mzg0NiwyNi41NDMyMDk5IFogTTIwLDE1LjgwNDI5ODEgQzE5LjQ0NDQ0MjcsMTUuODA0Mjk4MSAxOC45NzIyMjQsMTUuNjE5MzY4NyAxOC41ODMzMzMzLDE1LjI0OTUwNDYgQzE4LjE5NDQ0MjcsMTQuODc5NjQwNiAxOCwxNC40MzA1MjU1IDE4LDEzLjkwMjE0OTEgQzE4LDEzLjM3Mzc3MjYgMTguMTk0NDQyNywxMi45MjQ2NTc1IDE4LjU4MzMzMzMsMTIuNTU0NzkzNSBDMTguOTcyMjI0LDEyLjE4NDkyOTUgMTkuNDQ0NDQyNywxMiAyMCwxMiBDMjAuNTU1NTU3MywxMiAyMS4wMjc3NzYsMTIuMTg0OTI5NSAyMS40MTY2NjY3LDEyLjU1NDc5MzUgQzIxLjgwNTU1NzMsMTIuOTI0NjU3NSAyMiwxMy4zNzM3NzI2IDIyLDEzLjkwMjE0OTEgQzIyLDE0LjQzMDUyNTUgMjEuODA1NTU3MywxNC44Nzk2NDA2IDIxLjQxNjY2NjcsMTUuMjQ5NTA0NiBDMjEuMDI3Nzc2LDE1LjYxOTM2ODcgMjAuNTU1NTU3MywxNS44MDQyOTgxIDIwLDE1LjgwNDI5ODEgWiIgaWQ9IkNvbWJpbmVkLVNoYXBlIiBmaWxsPSIjRkZGRkZGIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyMC4wMDAwMDAsIDIwLjAwMDAwMCkgc2NhbGUoMSwgLTEpIHRyYW5zbGF0ZSgtMjAuMDAwMDAwLCAtMjAuMDAwMDAwKSAiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg==",error:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjQwcHgiIGhlaWdodD0iNDBweCIgdmlld0JveD0iMCAwIDQwIDQwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCAzOS4xICgzMTcyMCkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+aWNvbl9kYW5nZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iRWxlbWVudC1ndWlkZWxpbmUtdjAuMi40IiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iTWVzc2FnZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTYwLjAwMDAwMCwgLTMzMi4wMDAwMDApIj4KICAgICAgICAgICAgPGcgaWQ9IuW4puWAvuWQkV/kv6Hmga8iIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYwLjAwMDAwMCwgMzMyLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPGcgaWQ9IlJlY3RhbmdsZS0yIj4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iaWNvbl9kYW5nZXIiPgogICAgICAgICAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLTIiIGZpbGw9IiNGRjQ5NDkiIHg9IjAiIHk9IjAiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCI+PC9yZWN0PgogICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMjUuODE3MjYyNywxNi4zNDUxNzk2IEMyNS45MzkwOTAyLDE2LjIyMzM0ODMgMjYsMTYuMDc2MTQxOCAyNiwxNS45MDM1NTIzIEMyNiwxNS43MzA5NjI4IDI1LjkzOTA5MDIsMTUuNTgzNzU2MyAyNS44MTcyNjI3LDE1LjQ2MTkyODkgTDI0LjUwNzYxNTcsMTQuMTgyNzQxMSBDMjQuMzg1Nzg4MiwxNC4wNjA5MTM3IDI0LjI0MzY1NzUsMTQgMjQuMDgxMjE5NiwxNCBDMjMuOTE4NzgxNywxNCAyMy43NzY2NTEsMTQuMDYwOTEzNyAyMy42NTQ4MjM1LDE0LjE4Mjc0MTEgTDIwLDE3LjgzNzU2MzUgTDE2LjMxNDcyMTYsMTQuMTgyNzQxMSBDMTYuMTkyODkwMiwxNC4wNjA5MTM3IDE2LjA1MDc1OTUsMTQgMTUuODg4MzIxNiwxNCBDMTUuNzI1ODg3NiwxNCAxNS41ODM3NTY5LDE0LjA2MDkxMzcgMTUuNDYxOTI5NCwxNC4xODI3NDExIEwxNC4xNTIyODI0LDE1LjQ2MTkyODkgQzE0LjA1MDc1ODIsMTUuNTgzNzU2MyAxNCwxNS43MzA5NjI4IDE0LDE1LjkwMzU1MjMgQzE0LDE2LjA3NjE0MTggMTQuMDUwNzU4MiwxNi4yMjMzNDgzIDE0LjE1MjI4MjQsMTYuMzQ1MTc5NiBMMTcuODM3NTYwOCwyMC4wMDAwMDE5IEwxNC4xNTIyODI0LDIzLjY1NDgyNDMgQzE0LjA1MDc1ODIsMjMuNzc2NjUxNyAxNCwyMy45MjM4NTgyIDE0LDI0LjA5NjQ0NzcgQzE0LDI0LjI2OTAzNzIgMTQuMDUwNzU4MiwyNC40MTYyNDM3IDE0LjE1MjI4MjQsMjQuNTM4MDcxMSBMMTUuNDYxOTI5NCwyNS44MTcyNTg5IEMxNS41ODM3NTY5LDI1LjkzOTA4NjMgMTUuNzI1ODg3NiwyNiAxNS44ODgzMjE2LDI2IEMxNi4wNTA3NTk1LDI2IDE2LjE5Mjg5MDIsMjUuOTM5MDg2MyAxNi4zMTQ3MjE2LDI1LjgxNzI1ODkgTDIwLDIyLjE2MjQzNjUgTDIzLjY1NDgyMzUsMjUuODE3MjU4OSBDMjMuNzc2NjUxLDI1LjkzOTA4NjMgMjMuOTE4NzgxNywyNiAyNC4wODEyMTk2LDI2IEMyNC4yNDM2NTc1LDI2IDI0LjM4NTc4ODIsMjUuOTM5MDg2MyAyNC41MDc2MTU3LDI1LjgxNzI1ODkgTDI1LjgxNzI2MjcsMjQuNTM4MDcxMSBDMjUuOTM5MDkwMiwyNC40MTYyNDM3IDI2LDI0LjI2OTAzNzIgMjYsMjQuMDk2NDQ3NyBDMjYsMjMuOTIzODU4MiAyNS45MzkwOTAyLDIzLjc3NjY1MTcgMjUuODE3MjYyNywyMy42NTQ4MjQzIEwyMi4xMzE5ODA0LDIwLjAwMDAwMTkgTDI1LjgxNzI2MjcsMTYuMzQ1MTc5NiBaIiBpZD0iUGF0aCIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+"},c=function(i){var i=$.extend({},s,i),o=a[i.type]||a.info,r='<div m-message m-img-src="'+o+'" m-message-content="'+i.message+'" m-message-close="'+i.showClose+'" m-duration="'+i.duration+'"></div>';n.append(e(r)(t))},u=!1,d=function(t){if(!u){u=!0,c(t);var e=i.defer();return o(function(){u=!1,e.resolve()},1e3),e.promise}},l={scope:t,icon:"fa fa-warning"},m=function(t){t=$.extend({},l,t),r({boxWidth:"400px",animation:"",title:t.title,content:t.content,icon:t.icon,closeIcon:!0,scope:t.scope,buttons:{cancel:{text:"取消",btnClass:"ng-confirm-btn-cancel",action:t.cancel||angular.noop},confirm:{text:"确定",btnClass:"ng-confirm-btn-confirm",action:t.confirm||angular.noop}}})};return{message:c,error:function(t,e){return c({type:"error",message:e,scope:t})},success:function(t,e){return c({type:"success",message:e,scope:t})},uniqueError:function(t){return d({type:"error",message:t})},confirm:m}}]),window.APP.factory("DownloadService",[function(){return{download:function(t,e){if(t&&$.isPlainObject(e)){var i=document.createElementNS("http://www.w3.org/1999/xhtml","form");i.setAttribute("action",t),i.setAttribute("method","post"),document.body.appendChild(i),$.each(e,function(t,e){var o=document.createElementNS("http://www.w3.org/1999/xhtml","input");o.setAttribute("type","hidden"),o.setAttribute("name",t),o.setAttribute("value",e),i.appendChild(o)}),i.submit(),document.body.removeChild(i)}}}}]),window.APP.factory("PaginationService",["$compile",function(t){var e,i={};return i.setContainer=function(t){return e=$(t),this},i.render=function(i){var o='<div m-pagination m-record-total="'+i.total+'" m-page-num="'+i.page+'" m-page-count="'+i.pageCount+'"></div>';e.find("[m-pagination]").remove().end().append(t(o)(i.scope))},i}]),window.APP.factory("PostService",["$rootScope","$http","$q","MessageService","UtilService",function(t,e,i,o,r){var n={};return n.request=function(t,n,s){var a=i.defer();return e.post(t,n,{timeout:s||5e3}).success(function(t){t.data?a.resolve(t.data):t.error&&"unlogin"==t.error.code?o.uniqueError("用户未登录，请前去登录！").then(function(){window.location.href="/"}):a.reject(t.error)}).error(function(t,e){-1==e?(o.uniqueError("请求超时，请稍后尝试！"),r.stopLoading()):a.reject(e)}),a.promise},n}]),window.APP.factory("UtilService",["$animate",function(t){var e={},i=function(){var t,e,i=document.createElement("p"),o={width:"100px",height:"100px",overflowY:"scroll"};for(t in o)i.style[t]=o[t];return document.body.appendChild(i),e=i.offsetWidth-i.clientWidth,i.remove(),e}();e.lockBodyScroll=function(){$("html").css("overflow","hidden"),"hidden"!=document.body.style.overflow&&"no"!=document.body.scroll&&document.body.scrollHeight>document.body.offsetHeight&&$("body").css("border-right",i+"px solid transparent")},e.unlockBodyScroll=function(){$("html").css("overflow",""),$("body").css("border-right","")};return e.startLoading=function(){var e=$("body");this.lockBodyScroll(),$(".shade").css("background","transparent"),t.enter($('<div class="shade global-loading"><div class="loading-container"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></div></div>'),e,$(e[0].lastChild))},e.stopLoading=function(){this.unlockBodyScroll(),t.leave($(".global-loading")),$(".shade").css("background","")},e}]),window.APP.factory("EchartPieService",["$rootScope",function(t){var e,i={},o={title:{text:"",textStyle:{color:"#111"}},backgroundColor:"#ffff",tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},visualMap:{show:!1,min:0,max:500,inRange:{colorLightness:[.6,.3]}},series:[{name:"",type:"pie",radius:"70%",data:[].sort(function(t,e){return t.value-e.value}),roseType:"angle",label:{normal:{textStyle:{color:"#222"}}},labelLine:{normal:{lineStyle:{color:"#222"}}},itemStyle:{normal:{color:"#c23531",shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"},emphasis:{color:"#c23531",shadowBlur:100,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};return i.refresh=function(t,i,r,n){e=echarts.init(document.getElementById(t)),o.title.text=i,r&&(o.series[0].data=r),o.backgroundColor=n||"#ffff",e.setOption(o)},i}]),window.APP.factory("BarChartService",["$rootScope",function(t){var e={},i={title:{text:""},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["当前积分","消耗积分","产生积分"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"value"}],yAxis:[{type:"category",axisTick:{show:!1},data:["饮料","食物","衣服","鞋"]}],series:[{name:"当前积分",type:"bar",label:{normal:{show:!0,position:"inside"}},data:[200,170,240,244]},{name:"产生积分",type:"bar",stack:"总量",label:{normal:{show:!0}},data:[320,302,341,374]},{name:"消耗积分",type:"bar",stack:"总量",label:{normal:{show:!0,position:"left"}},data:[-120,-132,-101,-134]}]},o={title:{text:""},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},toolbox:{show:!0,feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:["4/10","4/11","4/12","4/13","4/14","4/15","4/16","4/17","4/18","4/19","4/20","4/21","4/22","4/23","4/24","4/25","4/26","4/27","4/28","4/29"]},yAxis:{type:"value",axisLabel:{formatter:"{value}"},axisPointer:{snap:!0}},visualMap:{show:!1,dimension:0,pieces:[{lte:6,color:"green"},{gt:6,lte:8,color:"red"},{gt:8,lte:14,color:"green"},{gt:14,lte:17,color:"red"},{gt:17,color:"green"}]},series:[{name:"积分数",type:"line",smooth:!0,data:[300,280,250,260,270,300,550,500,400,390,380,390,400,500,600,750,800,700,600,400],markArea:{data:[[{name:"周末",xAxis:"4/15"},{xAxis:"4/16"}],[{name:"假日",xAxis:"4/23"},{xAxis:"4/26"}]]}}]};return e.refreshBar=function(t,e,o,r){var n=echarts.init(document.getElementById(t));i.title.text=e||"",i.backgroundColor=r||"#ffff",o&&(i.series[0].data=o),n.setOption(i)},e.refreshLine=function(t,e){var i=echarts.init(document.getElementById(t));o.title.text=e||"",i.setOption(o)},e}]),window.APP.factory("QiniuUploaderService",["$rootScope","MessageService","UtilService",function(t,e,i){var o={},r={runtimes:"html5, flash, html4",max_file_size:"100mb",dragdrop:!1,chunk_size:"4mb",multi_selection:!0,auto_start:!0,get_new_uptoken:!1,unique_names:!0,save_key:!1};return o.initUploader=function(t){return Qiniu.uploader($.extend(!0,{},r,t))},o.initImgUploader=function(o){var o=$.extend(!0,{filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,gif,png"}]},init:{FilesAdded:function(t,e){i.startLoading()},Error:function(o,r,n){e.error(t,"图片上传失败，请稍后尝试！"),i.stopLoading()},UploadComplete:function(){e.success(t,"图片上传成功！"),i.stopLoading()}}},o);return this.initUploader(o)},o}]),window.APP.factory("MapChartService",["$rootScope",function(t){var e={"海门":[121.15,31.89],"鄂尔多斯":[109.781327,39.608266],"招远":[120.38,37.35],"舟山":[122.207216,29.985295],"齐齐哈尔":[123.97,47.33],"盐城":[120.13,33.38],"赤峰":[118.87,42.28],"青岛":[120.33,36.07],"乳山":[121.52,36.89],"金昌":[102.188043,38.520089],"泉州":[118.58,24.93],"莱西":[120.53,36.86],"日照":[119.46,35.42],"胶南":[119.97,35.88],"南通":[121.05,32.08],"拉萨":[91.11,29.97],"云浮":[112.02,22.93],"梅州":[116.1,24.55],"文登":[122.05,37.2],"上海":[121.48,31.22],"攀枝花":[101.718637,26.582347],"威海":[122.1,37.5],"承德":[117.93,40.97],"厦门":[118.1,24.46],"汕尾":[115.375279,22.786211],"潮州":[116.63,23.68],"丹东":[124.37,40.13],"太仓":[121.1,31.45],"曲靖":[103.79,25.51],"烟台":[121.39,37.52],"福州":[119.3,26.08],"瓦房店":[121.979603,39.627114],"即墨":[120.45,36.38],"抚顺":[123.97,41.97],"玉溪":[102.52,24.35],"张家口":[114.87,40.82],"阳泉":[113.57,37.85],"莱州":[119.942327,37.177017],"湖州":[120.1,30.86],"汕头":[116.69,23.39],"昆山":[120.95,31.39],"宁波":[121.56,29.86],"湛江":[110.359377,21.270708],"揭阳":[116.35,23.55],"荣成":[122.41,37.16],"连云港":[119.16,34.59],"葫芦岛":[120.836932,40.711052],"常熟":[120.74,31.64],"东莞":[113.75,23.04],"河源":[114.68,23.73],"淮安":[119.15,33.5],"泰州":[119.9,32.49],"南宁":[108.33,22.84],"营口":[122.18,40.65],"惠州":[114.4,23.09],"江阴":[120.26,31.91],"蓬莱":[120.75,37.8],"韶关":[113.62,24.84],"嘉峪关":[98.289152,39.77313],"广州":[113.23,23.16],"延安":[109.47,36.6],"太原":[112.53,37.87],"清远":[113.01,23.7],"中山":[113.38,22.52],"昆明":[102.73,25.04],"寿光":[118.73,36.86],"盘锦":[122.070714,41.119997],"长治":[113.08,36.18],"深圳":[114.07,22.62],"珠海":[113.52,22.3],"宿迁":[118.3,33.96],"咸阳":[108.72,34.36],"铜川":[109.11,35.09],"平度":[119.97,36.77],"佛山":[113.11,23.05],"海口":[110.35,20.02],"江门":[113.06,22.61],"章丘":[117.53,36.72],"肇庆":[112.44,23.05],"大连":[121.62,38.92],"临汾":[111.5,36.08],"吴江":[120.63,31.16],"石嘴山":[106.39,39.04],"沈阳":[123.38,41.8],"苏州":[120.62,31.32],"茂名":[110.88,21.68],"嘉兴":[120.76,30.77],"长春":[125.35,43.88],"胶州":[120.03336,36.264622],"银川":[106.27,38.47],"张家港":[120.555821,31.875428],"三门峡":[111.19,34.76],"锦州":[121.15,41.13],"南昌":[115.89,28.68],"柳州":[109.4,24.33],"三亚":[109.511909,18.252847],"自贡":[104.778442,29.33903],"吉林":[126.57,43.87],"阳江":[111.95,21.85],"泸州":[105.39,28.91],"西宁":[101.74,36.56],"宜宾":[104.56,29.77],"呼和浩特":[111.65,40.82],"成都":[104.06,30.67],"大同":[113.3,40.12],"镇江":[119.44,32.2],"桂林":[110.28,25.29],"张家界":[110.479191,29.117096],"宜兴":[119.82,31.36],"北海":[109.12,21.49],"西安":[108.95,34.27],"金坛":[119.56,31.74],"东营":[118.49,37.46],"牡丹江":[129.58,44.6],"遵义":[106.9,27.7],"绍兴":[120.58,30.01],"扬州":[119.42,32.39],"常州":[119.95,31.79],"潍坊":[119.1,36.62],"重庆":[106.54,29.59],"台州":[121.420757,28.656386],"南京":[118.78,32.04],"滨州":[118.03,37.36],"贵阳":[106.71,26.57],"无锡":[120.29,31.59],"本溪":[123.73,41.3],"克拉玛依":[84.77,45.59],"渭南":[109.5,34.52],"马鞍山":[118.48,31.56],"宝鸡":[107.15,34.38],"焦作":[113.21,35.24],"句容":[119.16,31.95],"北京":[116.46,39.92],"徐州":[117.2,34.26],"衡水":[115.72,37.72],"包头":[110,40.58],"绵阳":[104.73,31.48],"乌鲁木齐":[87.68,43.77],"枣庄":[117.57,34.86],"杭州":[120.19,30.26],"淄博":[118.05,36.78],"鞍山":[122.85,41.12],"溧阳":[119.48,31.43],"库尔勒":[86.06,41.68],"安阳":[114.35,36.1],"开封":[114.35,34.79],"济南":[117,36.65],"德阳":[104.37,31.13],"温州":[120.65,28.01],"九江":[115.97,29.71],"邯郸":[114.47,36.6],"临安":[119.72,30.23],"兰州":[103.73,36.03],"沧州":[116.83,38.33],"临沂":[118.35,35.05],"南充":[106.110698,30.837793],"天津":[117.2,39.13],"富阳":[119.95,30.07],"泰安":[117.13,36.18],"诸暨":[120.23,29.71],"郑州":[113.65,34.76],"哈尔滨":[126.63,45.75],"聊城":[115.97,36.45],"芜湖":[118.38,31.33],"唐山":[118.02,39.63],"平顶山":[113.29,33.75],"邢台":[114.48,37.05],"德州":[116.29,37.45],"济宁":[116.59,35.38],"荆州":[112.239741,30.335165],"宜昌":[111.3,30.7],"义乌":[120.06,29.32],"丽水":[119.92,28.45],"洛阳":[112.44,34.7],"秦皇岛":[119.57,39.95],"株洲":[113.16,27.83],"石家庄":[114.48,38.03],"莱芜":[117.67,36.19],"常德":[111.69,29.05],"保定":[115.48,38.85],"湘潭":[112.91,27.87],"金华":[119.64,29.12],"岳阳":[113.09,29.37],"长沙":[113,28.21],"衢州":[118.88,28.97],"廊坊":[116.7,39.53],"菏泽":[115.480656,35.23375],"合肥":[117.27,31.86],"武汉":[114.31,30.52],"大庆":[125.03,46.58]},i=function(t){for(var i=[],o=0;o<t.length;o++){var r=e[t[o].name];r&&i.push({name:t[o].name,value:r.concat(t[o].value)})}return i};option={backgroundColor:"#404a59",title:{text:"地图表",x:"center",y:"5%",textStyle:{color:"#333"}},tooltip:{trigger:"item",formatter:function(t){
return t.name+" : "+t.value[2]}},legend:{orient:"vertical",y:"bottom",x:"right",data:["会员数"],textStyle:{color:"#333"}},visualMap:{min:0,max:500,calculable:!0,color:["#d94e5d","#eac736","#50a3ba"],textStyle:{color:"#111"}},geo:{map:"china",label:{emphasis:{show:!1}},itemStyle:{normal:{areaColor:"#2c333a",borderColor:"#444"},emphasis:{areaColor:"#666666"}}},series:[{name:"会员数",type:"scatter",coordinateSystem:"geo",data:i([{name:"成都",value:169},{name:"长沙",value:175},{name:"上海",value:177},{name:"北京",value:193},{name:"广州",value:194},{name:"合肥",value:229},{name:"深圳",value:273},{name:"大庆",value:279}]),symbolSize:10,label:{normal:{show:!1},emphasis:{show:!1}},itemStyle:{emphasis:{borderColor:"rgba(255,255,255,0.5)",borderWidth:1}}}]};var o={};return o.refresh=function(t,e,o,r){var n=echarts.init(document.getElementById(t));e&&(option.title.text=e),o&&(option.series[0].data=i(o)),option.backgroundColor=r||"#ffff",n.setOption(option)},o}]),window.APP.factory("qiNiuService",["$rootScope",function(t){var e={};return e.init=function(t,e,i,o){Qiniu.uploader({browse_button:t,uptoken_url:e,get_new_uptoken:!1,unique_names:!0,save_key:!1,domain:i,chunk_size:"500kb",auto_start:!0,init:{FileUploaded:function(t,e,i){o(i)},Key:function(t,e){return""}}})},e}]),window.APP.factory("editorService",["$rootScope",function(t){var e={};return e.init=function(t,e,i,o){function r(){var t=this,o=t.customUploadBtnId,r=t.customUploadContainerId;Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:o,uptoken_url:e,domain:i,container:r,chunk_size:"4mb",auto_start:!0,init:{UploadProgress:function(e,i){t.showUploadProgress(i.percent)},FileUploaded:function(e,o,r){var n=JSON.parse(r),s=i+n.key;t.command(null,"insertHtml",'<img src="'+s+'" style="max-width:100%;"/>')},UploadComplete:function(){t.hideUploadProgress()}}})}var n=new wangEditor(t);n.config.menus=$.map(wangEditor.config.menus,function(t,e){return"insertcode"===t?null:"fullscreen"===t?null:"location"===t?null:"video"===t?null:"emotion"===t?null:t}),n.config.customUpload=!0,n.config.customUploadInit=r,n.onchange=function(){o(this.$txt.html())},n.create()},e}]),window.APP.factory("CustomerGroupService",["PostService",function(t){function e(t){var e={};for(var i in t)t.hasOwnProperty(i)&&""!=t[i]&&(e[i]=t[i]);return e}var i={page:1,size:10,query:{grouptype:1,groupname:""}},o={};return o.query=function(o){return o=$.extend(!0,{},i,o),o.query=JSON.stringify(e(o.query)),t.request("/cgroup/list",$.param(o))},o.deleteItems=function(e){return t.request("/cgroup/deletegr",$.param({listid:JSON.stringify({list:e})}))},o.save=function(e){return t.request("/cgroup/update",$.param({group:JSON.stringify(e)}))},o}]),window.APP.controller("customerGroupCtrl",["$scope","CustomerGroupService","PaginationService","MessageService","UtilService",function(t,e,i,o,r){function n(){this.defaultQuery={grouptype:1,groupname:""},this.items=[],this.selectedItems=[],this.queryOptions={page:1,size:10,query:$.extend({},this.defaultQuery)},this.pagination={page:this.queryOptions.page,size:this.queryOptions.size,total:0,pageCount:0,scope:t}}function s(t){this.groupList=t,this.defaultGroup={groupid:"",grouptype:1,groupname:"",groupdesc:""},this.group=$.extend(!0,{},this.defaultGroup),this.showAdd=!1,this.showEdit=!1,this.errors={}}n.prototype.query=function(n){var s=this;r.startLoading(),s.queryOptions.page=n||s.queryOptions.page,e.query(s.queryOptions).then(function(t){s.items=t.data,s.pagination.page=t.page,s.pagination.total=t.total,s.pagination.pageCount=t.totalpage,s.selectedItems=[],i.setContainer(".view-table").render(s.pagination)}).catch(function(e){o.error(t,"数据获取失败，请稍后尝试！")}).finally(function(){r.stopLoading()})},n.prototype.resetQuery=function(){this.queryOptions.query=$.extend({},this.defaultQuery),this.query(1)},n.prototype.isCheckedAll=function(){return this.selectedItems.length==this.items.length&&0!=this.selectedItems.length},n.prototype.isChecked=function(t){return-1!=this.selectedItems.indexOf(t)},n.prototype.toggleCheckedAll=function(){if(this.isCheckedAll())return void(this.selectedItems=[]);for(var t=0,e=this.items.length;t<e;t++){var i=this.items[t];-1==this.selectedItems.indexOf(i)&&this.selectedItems.push(i)}},n.prototype.toggleChecked=function(t){var e=this.selectedItems.indexOf(t);-1==e?this.selectedItems.push(t):this.selectedItems.splice(e,1)},n.prototype.deleteSelectedItems=function(){for(var i=this,n=i.selectedItems.length,s=[],a=0;a<n;a++)s.push(i.selectedItems[a].groupid);o.confirm({title:"确认删除？",content:"确定删除用户分组吗，删除后无法恢复？",confirm:function(){r.startLoading(),e.deleteItems(s).then(function(e){i.query(),o.success(t,"分组删除成功！")}).catch(function(e){o.error(t,"分组删除失败，请稍后尝试！")}).finally(function(){r.stopLoading()})}})},s.prototype.setGroup=function(t){this.group=$.extend(!0,{},this.defaultGroup,t)},s.prototype.validate=function(){return this.errors={},""==this.group.groupname.trim()&&(this.errors.groupname="分组名称为必填项"),this.group.groupname.length>20&&(this.errors.groupname="分组名称的最大长度为20"),this.group.groupdesc&&this.group.groupdesc.length>50&&(this.errors.groupdesc="分组描述的最大长度为50"),angular.equals(this.errors,{})},s.prototype.saveGroup=function(){var i=this;i.validate()&&(r.startLoading(),e.save(i.group).then(function(e){i.groupList.query(),i.closeForm(),o.success(t,"分组保存成功！")}).catch(function(e){"exists"==e.code&&(i.errors.groupname="分组名称已被占用！"),o.error(t,"分组保存失败，请稍候尝试！")}).finally(function(){r.stopLoading()}))},s.prototype.showAddForm=function(){this.showAdd=!0},s.prototype.showEditForm=function(t){this.setGroup(t),this.showEdit=!0},s.prototype.closeForm=function(){this.group=$.extend(!0,{},this.defaultGroup),this.errors={},this.showAdd=!1,this.showEdit=!1},t.groupList=new n,t.groupForm=new s(t.groupList),t.groupList.query(),t.$on("goPage",function(e,i){t.groupList.query(i)})}]),window.APP.factory("CustomerService",["PostService",function(t){var e={};return e.query=function(e){return e=$.extend(!0,{},e),e.query=JSON.stringify(e.query),t.request("/customer/list",$.param(e))},e.setGroup=function(e){return t.request("/customer/group",$.param({detail:JSON.stringify(e)}))},e.queryPointRecord=function(e){return t.request("/club/getPointRecord",$.param(e))},e.queryPrizeRecord=function(e){return t.request("/club/getPrizeRecord",$.param(e))},e}]),window.APP.controller("customerCtrl",["$scope","CustomerService","PaginationService","MessageService","CustomerGroupService","UtilService",function(t,e,i,o,r,n){function s(){this.items=[],this.selectedItems=[],this.defaultQuery={custtype:1,nickname:"",minlotterytime:"",maxlotterytime:"",minpoint:"",maxpoint:""},this.queryOptions={page:1,size:10,query:$.extend({},this.defaultQuery)},this.pagination={page:this.queryOptions.page,size:this.queryOptions.size,total:0,pageCount:0,scope:t},this.dropDownItems=[]}function a(){this.customer=null,this.showList=!1,this.items=[],this.timeType="0"}function c(){this.customer=null,this.showList=!1,this.items=[],this.timeType="0"}s.prototype.loadDropDownItems=function(){var t=this;r.query({size:1e4}).then(function(e){t.dropDownItems=e.data}).catch(function(t){})},s.prototype.query=function(r){var s=this;n.startLoading(),s.queryOptions.page=r||s.queryOptions.page,e.query(s.queryOptions).then(function(t){s.items=t.data,s.pagination.page=t.page,s.pagination.total=t.total,s.pagination.pageCount=t.totalpage,s.selectedItems=[],i.setContainer(".view-table").render(s.pagination)}).catch(function(e){o.error(t,"数据获取失败, 请稍后尝试！")}).finally(function(){n.stopLoading()})},s.prototype.resetQuery=function(){this.queryOptions.query=$.extend({},this.defaultQuery),this.query(1)},s.prototype.isCheckedAll=function(){return this.selectedItems.length==this.items.length&&0!=this.selectedItems.length},s.prototype.isChecked=function(t){return-1!=this.selectedItems.indexOf(t)},s.prototype.toggleCheckedAll=function(){if(this.isCheckedAll())return void(this.selectedItems=[]);for(var t=0,e=this.items.length;t<e;t++){var i=this.items[t];-1==this.selectedItems.indexOf(i)&&this.selectedItems.push(i)}},s.prototype.toggleChecked=function(t){var e=this.selectedItems.indexOf(t);-1==e?this.selectedItems.push(t):this.selectedItems.splice(e,1)},s.prototype.setGroup=function(i,r){var s=this,a=[];r?a=[r.custid]:$.each(s.selectedItems,function(t,e){a.push(e.custid)}),n.startLoading(),e.setGroup({idlist:a,groupid:i.groupid,groupname:i.groupname}).then(function(e){r?r.groupname=i.groupname:s.query(),o.success(t,"分组设置成功！")}).catch(function(e){o.error(t,"分组设置失败，请稍后尝试！")}).finally(function(){n.stopLoading()})},a.prototype.loadList=function(){var i=this;n.startLoading();var r=moment().format("YYYY-MM-DD"),s=moment();"0"==i.timeType?s=moment().subtract(1,"months"):"1"==i.timeType?s=moment().subtract(3,"months"):"2"==i.timeType&&(s=moment().subtract(1,"years")),s=s.format("YYYY-MM-DD"),e.queryPointRecord({custid:i.customer.custid,begtime:s,endtime:r,pagenumber:1,pagerows:100}).then(function(t){i.items=t.rows}).catch(function(e){o.error(t,"积分记录加载失败，请稍后重试！")}).finally(function(){n.stopLoading()})},a.prototype.show=function(t){this.customer=t,this.showList=!0,this.loadList()},a.prototype.close=function(){this.showList=!1,this.customer=null,this.items=[],this.timeType="0"},a.prototype.selectTimeType=function(t){this.timeType=t,this.items=[],this.loadList()},c.prototype.loadList=function(){var i=this;n.startLoading();var r=moment().format("YYYY-MM-DD"),s=moment();"0"==i.timeType?s=moment().subtract(1,"months"):"1"==i.timeType?s=moment().subtract(3,"months"):"2"==i.timeType&&(s=moment().subtract(1,"years")),s=s.format("YYYY-MM-DD"),e.queryPrizeRecord({custid:i.customer.custid,begtime:s,endtime:r,pagenumber:1,pagerows:100}).then(function(t){i.items=t.rows}).catch(function(e){o.error(t,"中奖记录加载失败，请稍后重试！")}).finally(function(){n.stopLoading()})},c.prototype.show=function(t){this.customer=t,this.showList=!0,this.loadList()},c.prototype.close=function(){this.showList=!1,this.customer=null,this.items=[],this.timeType="0"},c.prototype.selectTimeType=function(t){this.timeType=t,this.items=[],this.loadList()},t.customerList=new s,t.pointRecordList=new a,t.prizeRecordList=new c,t.customerList.query(),t.customerList.loadDropDownItems(),t.$on("goPage",function(e,i){t.customerList.query(i)})}]),window.APP.factory("CommondityCategoryService",["PostService",function(t){var e={};return e.query=function(e){return e=$.extend({},e),e.query=JSON.stringify(e.query),t.request("/mcdManage/getCategoryList",$.param(e))},e.deleteItems=function(e){return t.request("/mcdManage/delCategory",$.param({listid:JSON.stringify({list:e})}))},e.save=function(e){return t.request("/mcdManage/saveOrUpdCategory",$.param({categoryInfo:JSON.stringify(e)}))},e}]),window.APP.controller("commondityCategoryCtrl",["$scope","CommondityCategoryService","PaginationService","MessageService","UtilService",function(t,e,i,o,r){function n(){this.items=[],this.selectedItems=[],this.queryOptions={page:1,size:10,query:{name:"",state:"1"}},this.pagination={page:this.queryOptions.page,size:this.queryOptions.size,total:0,pageCount:0,scope:t}}function s(t){this.categoryList=t,this.defaultCategory={categoryid:"",name:"",categorydesc:""},this.category=$.extend({},this.defaultCategory),this.showAdd=!1,this.showEdit=!1,this.errors={}}n.prototype.query=function(n){var s=this;r.startLoading(),s.queryOptions.page=n||s.queryOptions.page,e.query(s.queryOptions).then(function(t){s.items=t.data,s.pagination.page=t.page,s.pagination.total=t.totalsize,s.pagination.pageCount=t.totalpage,s.selectedItems=[],i.setContainer(".view-table").render(s.pagination)}).catch(function(e){o.success(t,"数据获取失败，请稍后尝试！")}).finally(function(){r.stopLoading()})},n.prototype.resetQuery=function(){this.queryOptions.query.name="",this.query(1)},n.prototype.isCheckedAll=function(){return this.selectedItems.length==this.items.length&&0!=this.selectedItems.length},n.prototype.isChecked=function(t){return-1!=this.selectedItems.indexOf(t)},n.prototype.toggleCheckedAll=function(){if(this.isCheckedAll())return void(this.selectedItems=[]);for(var t=0,e=this.items.length;t<e;t++){var i=this.items[t];-1==this.selectedItems.indexOf(i)&&this.selectedItems.push(i)}},n.prototype.toggleChecked=function(t){var e=this.selectedItems.indexOf(t);-1==e?this.selectedItems.push(t):this.selectedItems.splice(e,1)},n.prototype.deleteSelectedItems=function(){var i=this,n=i.selectedItems.length,s=[];r.startLoading();for(var a=0;a<n;a++)s.push(i.selectedItems[a].categoryid);o.confirm({title:"确认删除？",content:"确认删除商品分类？当选择的分类有关联的商品时，删除将会失败！",confirm:function(){e.deleteItems(s).then(function(e){i.query(),o.success(t,"商品分类删除成功！")}).catch(function(e){var i="商品分类删除失败，请稍后尝试！";"mcdoccupied"==e.code&&(i="商品分类删除失败，该类别有关联的商品！"),o.error(t,i)}).finally(function(){r.stopLoading()})}})},s.prototype.showAddForm=function(){this.showAdd=!0},s.prototype.showEditForm=function(t){this.category=$.extend({},t),this.showEdit=!0},s.prototype.closeForm=function(){this.category=$.extend({},this.defaultCategory),this.errors={},this.showEdit=!1,this.showAdd=!1},s.prototype.validate=function(){return this.errors={},""==this.category.name.trim()&&(this.errors.name="分类名称为必填项"),this.category.name.length>20&&(this.errors.name="分类名称的最大长度为20"),this.category.categorydesc&&this.category.categorydesc.length>50&&(this.erros.categorydesc="分类描述的最大长度为50"),angular.equals(this.errors,{})},s.prototype.saveCategory=function(){var i=this;i.validate()&&(r.startLoading(),e.save(i.category).then(function(e){i.categoryList.query(),i.closeForm(),o.success(t,"分类保存成功！")}).catch(function(e){"exists"==e.code&&(i.errors.name="商品分类名称已被占用！"),o.error(t,"分类保存失败，请稍后尝试！")}).finally(function(){r.stopLoading()}))},t.categoryList=new n,t.categoryForm=new s(t.categoryList),t.$on("goPage",function(e,i){t.categoryList.query(i)}),t.categoryList.query()}]),window.APP.factory("QrService",["PostService",function(t){var e={};return e.query=function(e){return t.request("/mcdManage/getMcdQRbatchList",$.param(e))},e.sendEmail=function(e){return t.request("/mcdManage/sendMcdQREmail",$.param({batchid:e.batchid,key:e.key}))},e.addBatch=function(){return t.request("/mcdManage/getAddQRbatch")},e.addQr=function(e){return t.request("/mcdManage/addMcdQR",$.param(e))},e}]),window.APP.factory("CommondityService",["PostService",function(t){var e={};return e.query=function(e){return e=$.extend(!0,{},e),!e.query||""==e.query.mcdname.trim()&&""==e.query.batchcode.trim()&&""==e.query.categoryid.trim()?delete e.query:e.query=JSON.stringify(e.query),t.request("/mcdManage/getMcdList",$.param(e))},e.save=function(e){return t.request("/mcdManage/saveOrUpdMcd",$.param(e))},e.offShelve=function(e){return t.request("/mcdManage/delMcd",$.param({mcdId:JSON.stringify({list:e})}))},e}]),window.APP.controller("commondityCtrl",["$scope","$timeout","$interval","CommondityService","MessageService","PaginationService","CommondityCategoryService","QrService","UtilService",function(t,e,i,o,r,n,s,a,c){function u(){this.items=[],this.selectedItems=[],this.defaultQuery={mcdname:"",batchcode:"",categoryid:""},this.queryOptions={page:1,size:10,query:$.extend({},this.defaultQuery)},this.pagination={page:this.queryOptions.page,size:this.queryOptions.size,total:0,pageCount:0,scope:t},this.dropDownItems=[]}function d(t){this.commondityList=t,this.defaultCommondity={mcdid:"",mcdname:"",mcddesc:"",categoryid:"",point:1},this.commondity=$.extend({},this.defaultCommondity),this.showAdd=this.showEdit=!1,this.erros={}}function l(){this.commondity=null,this.items=[],this.show=!1,this.showForm=!1,this.countDown=0,this.emailBtnText="发送邮件"}function m(t,e){this.qrList=t,this.commondityList=e,this.isReady=!1,this.defaultQr={batchCode:"",amount:1,mcdid:""},this.qr=$.extend({},this.defaultQr),this.errors={},this.isBusy=!1,this.progress=0}u.prototype.loadDropDownItems=function(){var t=this;s.query({size:1e6,page:1}).then(function(e){t.dropDownItems=e.data}).catch(function(t){console.log(t)})},u.prototype.query=function(e){var i=this;c.startLoading(),i.queryOptions.page=e||i.queryOptions.page,o.query(i.queryOptions).then(function(t){i.items=t.data,i.selectedItems=[],i.pagination.page=t.page,i.pagination.total=t.totalsize,i.pagination.pageCount=t.totalpage,n.setContainer("#commondityTable").render(i.pagination)}).catch(function(e){r.error(t,"数据获取失败，请稍后尝试！")}).finally(function(){c.stopLoading()})},u.prototype.resetQuery=function(){this.queryOptions.query=$.extend({},this.defaultQuery),this.query(1)},u.prototype.isCheckedAll=function(){return this.selectedItems.length==this.items.length&&0!=this.selectedItems.length},u.prototype.isChecked=function(t){return-1!=this.selectedItems.indexOf(t)},u.prototype.toggleCheckedAll=function(){if(this.isCheckedAll())return void(this.selectedItems=[]);for(var t=0,e=this.items.length;t<e;t++){var i=this.items[t];-1==this.selectedItems.indexOf(i)&&this.selectedItems.push(i)}},u.prototype.toggleChecked=function(t){var e=this.selectedItems.indexOf(t);-1==e?this.selectedItems.push(t):this.selectedItems.splice(e,1)},u.prototype.offShelve=function(e){var i=this;r.confirm({title:"确定下架？",content:"确定下架商品？商品所属分类如果有关联活动将会导致下架失败！",confirm:function(){c.startLoading();var n=[e.mcdid];o.offShelve(n).then(function(e){r.success(t,"商品下架成功！"),i.query()}).catch(function(e){var i="商品下架失败！";"projectoccupied"==e.code&&(i="商品下架失败，商品所属分类已有关联活动！"),r.error(t,i)}).finally(function(){c.stopLoading()})}})},d.prototype.showAddForm=function(){this.showAdd=!0},d.prototype.showEditForm=function(t){this.commondity=$.extend({},t),this.showEdit=!0},d.prototype.closeForm=function(){this.commondity=$.extend({},this.defaultCommondity),this.errors={},this.showAdd=this.showEdit=!1},d.prototype.validate=function(){this.errors={},""==this.commondity.mcdname.trim()?this.errors.mcdname="商品名称为必填项":this.commondity.mcdname.length>20&&(this.errors.mcdname="商品名称的最大长度为20"),this.commondity.mcddesc&&this.commondity.mcddesc.length>50&&(this.errors.mcddesc="商品描述的最大长度为50"),""==this.commondity.categoryid&&(this.errors.categoryid="请选择商品分类");var t=this.commondity.point;return""===t?this.errors.point="预设积分为必填项":!isNaN(t)&&0<t&&t<1e4&&t%1==0||(this.errors.point="请输入大于0小于10000的整数"),angular.equals(this.errors,{})},d.prototype.saveCommondity=function(){var e=this;e.validate()&&(c.startLoading(),o.save(e.commondity).then(function(i){e.commondityList.query(),e.closeForm(),r.success(t,"商品保存成功！")}).catch(function(i){"exists"==i.code&&(e.errors.mcdname="商品名称已被占用！"),r.error(t,"商品保存失败，请稍后尝试！")}).finally(function(){c.stopLoading()}))},l.prototype.loadList=function(){var e=this;c.startLoading(),a.query({mcdId:e.commondity.mcdid,page:1,size:100}).then(function(t){e.items=t.data,e.show=!0}).catch(function(e){r.error(t,"二维码列表获取失败！")}).finally(function(){c.stopLoading()})},l.prototype.showList=function(t){this.commondity=t,this.loadList()},l.prototype.sendEmail=function(e){var o=this;c.startLoading(),a.sendEmail(e).then(function(e){r.success(t,"邮件发送成功，请注意查收！")}).catch(function(e){r.error(t,"邮件发送失败，请稍后重试！")}).finally(function(){o.countDown=60,o.emailBtnText=o.countDown+"S 后重新发送";var t=i(function(){o.countDown>1?(o.countDown-=1,o.emailBtnText=o.countDown+"S 后重新发送"):(o.countDown=0,o.emailBtnText="发送邮件",i.cancel(t))},1e3);c.stopLoading()})},l.prototype.close=function(){this.commondity=null,this.show=!1,this.showForm=!1,this.items=[]},m.prototype.show=function(){var e=this;c.startLoading(),e.qrList.showForm=!0,e.isReady=!1,e.progress=0,this.errors={},e.qr=$.extend({},e.defaultQr),e.qrList.commondity&&(e.qr.mcdid=e.qrList.commondity.mcdid),a.addBatch().then(function(t){e.isReady=!0,e.qr.batchCode=t}).catch(function(e){r.error(t,"二维码批次号生成失败，请稍候重试！")}).finally(function(){c.stopLoading()})},m.prototype.validate=function(){this.errors={};var t=this.qr.amount;return!isNaN(t)&&0<t&&t<=1e5&&t%1==0||(this.errors.amount="请输入大于0小于等于100000的整数"),angular.equals(this.errors,{})},m.prototype.addQr=function(){var i=this;i.validate()&&(i.isBusy||c.startLoading(),a.addQr(i.qr).then(function(o){i.isBusy=!0,i.progress=100*parseFloat(o.progress).toFixed(2),1==parseFloat(o.progress)?(r.success(t,"二维码生成成功！"),i.close(),i.isBusy=!1,i.qrList.loadList(),i.commondityList.query()):parseFloat(o.progress)<1&&e(function(){i.addQr()},500)}).catch(function(e){i.isBusy=!1,r.error(t,"二维码生成出错，请稍后重试！")}).finally(function(){i.isBusy||c.stopLoading()}))},m.prototype.close=function(){this.qrList.showForm=!1},t.commondityList=new u,t.commondityForm=new d(t.commondityList),t.qrList=new l,t.qrForm=new m(t.qrList,t.commondityList),t.$on("goPage",function(e,i){t.commondityList.query(i)}),t.commondityList.loadDropDownItems(),t.commondityList.query()}]),window.APP.controller("commondityAdCtrl",["$scope","PaginationService","HostConfig","MessageService","PostService","UtilService",function(t,e,i,o,r,n){function s(){this.queryOptions={adtype:""},this.items=[],this.selectedItems=[],this.selectedOne="focus",this.articleList=[],this.active=""}function a(t){this.queryOptions={pagenumber:1,pagerows:5,key:"",entid:window.localStorage.getItem("entid"),begtime:"",endtime:"",state:""},this.adverOptions={begtime:"",endtime:"",artid:"",adtype:""},this.showAdd=!1,this.showEdit=!1,this.articleslist=[],this.error={},this.items=[],this.selectedItems=[]}var c=i.adtype;t.positionlist=[];for(var u in c)t.positionlist.push(c[u]);for(var d=0;d<t.positionlist.length;d++)t.positionlist[d]={title:t.positionlist[d].title,adtype:t.positionlist[d].key};s.prototype.query=function(e,i){var s=this;n.startLoading(),r.request(e,$.param(i)).then(function(t){s.articleList=t,s.items=t}).catch(function(e){o.error(t,"数据操作失败，请稍后尝试！")}).finally(function(){n.stopLoading()})},s.prototype.init=function(){this.query("/club/getAdList",{adtype:"focus"})},s.prototype.delArticle=function(t){var e=this,i={adid:t},r={adtype:e.selectedOne};o.confirm({title:"删除操作提醒",content:"确定删除该文章吗？",icon:"fa fa-warning",confirm:function(){e.query("/club/delAdItem",i),e.query("/club/getAdList",r)},cancel:function(){}})},s.prototype.selectPos=function(t){var e=this;e.selectedOne=t.adtype,e.articleList=[];var i={adtype:t.adtype};e.query("/club/getAdList",i)},s.prototype.isCheckedAll=function(){return this.selectedItems.length==this.items.length&&0!=this.selectedItems.length},s.prototype.isChecked=function(t){return-1!=this.selectedItems.indexOf(t)},s.prototype.toggleCheckedAll=function(){if(this.isCheckedAll())return void(this.selectedItems=[]);for(var t=0,e=this.items.length;t<e;t++){var i=this.items[t];-1==this.selectedItems.indexOf(i)&&this.selectedItems.push(i)}},s.prototype.toggleChecked=function(t){var e=this.selectedItems.indexOf(t);-1==e?this.selectedItems.push(t):this.selectedItems.splice(e,1)},a.prototype.showAddForm=function(){this.getArticlesList(),this.showAdd=!0},a.prototype.closeForm=function(){this.articleslist=[],this.adverOptions={begtime:"",endtime:"",artid:"",adtype:""},this.queryOptions.key="",t.advertiseList.init(),this.showAdd=!1},a.prototype.getArticlesList=function(i){var s=this;s.articleslist=[],s.queryOptions.pagenumber=i||1,n.startLoading(),r.request("/club/getarticlebyentid",$.param(s.queryOptions)).then(function(o){s.articleslist=o.rows,s.items=o.rows,e.setContainer("#viewTable").render({page:i||s.queryOptions.pagenumber,size:s.queryOptions.pagerows,total:parseInt(o.count),pageCount:Math.ceil(parseInt(o.count)/s.queryOptions.pagerows),scope:t})}).catch(function(e){o.error(t,"数据获取失败，请稍后尝试！")}).finally(function(){n.stopLoading()})},a.prototype.add=function(e,i){var n=this,s=new Date,a={artid:i,adtype:n.adverOptions.adtype,begtime:new Date(n.adverOptions.begtime).getTime(),endtime:new Date(n.adverOptions.endtime).getTime()};return a.adtype?a.endtime&&a.begtime?a.endtime<=a.begtime?o.error(t,"结束时间不能晚于开始时间"):a.begtime<s.getTime()?o.error(t,"开始时间不能晚于当前时间"):void r.request("/club/addAdItem",$.param(a)).then(function(e){n.res=e,n.res&&o.success(t,"添加成功！")}).catch(function(e){o.error(t,"数据操作失败，请稍后尝试！")}).finally(function(){}):o.error(t,"请设置开始时间和结束时间"):o.error(t,"请选择广告位")},t.advertiseList=new s,t.setarticleAdid=new a(t.advertiseList),t.advertiseList.init(),t.$on("goPage",function(e,i){t.setarticleAdid.queryOptions.key="",t.setarticleAdid.getArticlesList(i)})}]),window.APP.controller("commonditySaleCtrl",["$scope","PaginationService","$http","HostConfig","MessageService","ConfirmService","ValiService","QiniuUploaderService","editorService",function(t,e,i,o,r,n,s,a,c){t.isCollapse=!1,t.commondity={},t.edit={},t.toggleCollapse=function(){t.isCollapse=!t.isCollapse},t.tableItems=[],t.queryCondition={key:"",begtime:"",endtime:"",state:""};var u=function(o){i({method:"POST",url:"/club/getarticlebyentid",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:$.param({pagenumber:o||1,pagerows:5,key:t.queryCondition.key,entid:window.localStorage.getItem("entid"),begtime:t.queryCondition.begtime,endtime:t.queryCondition.endtime,state:t.queryCondition.state})}).success(function(i){s.check(i),i.data&&i.data.rows&&(console.info("request success"),t.tableItems=i.data.rows,t.checkedItems=[],e.setContainer(".view-table").render({page:o||1,size:5,total:parseInt(i.data.count),pageCount:Math.ceil(parseInt(i.data.count)/5),scope:t}))}).error(function(e){r.error(t,"保存失败！")})};u(),t.query=function(t){u(t)},t.queryReset=function(){t.queryCondition={key:"",begtime:"",endtime:"",state:""},u()},t.showAddartcle=function(){t.commondity.content="",t.showAddForm=!0,t.commondity.artid="",t.commondity.title="",t.commondity.keyword="",t.commondity.summary="",t.commondity.author="",t.commondity.authorurl="",t.commondity.arttype="",t.commondity.publishtime=new Date;var e=new Date;t.commondity.outtime=new Date(e.setDate(e.getDate()+1)),t.commondity.titleimageurl=""},t.close=function(){r.confirm({title:"提示",content:"确定取消吗？",confirm:function(){t.category={categoryid:"",name:"",categorydesc:""},t.showAddForm=!1,t.showEditForm=!1,t.$apply()}})},t.closeform=function(){t.category={categoryid:"",name:"",categorydesc:""},t.showAddForm=!1,t.showEditForm=!1},t.initEdit=function(){t.imgscan(),c.init("divedit","/uploader/getarticletoken",o.mall.articleimageurl,function(e){t.commondity.content=e})},t.save=function(){return s.Notempty(t.commondity.title)?t.commondity.title.length>30?void r.error(t,"标题不超过30个字！"):s.Notempty(t.commondity.keyword)?t.commondity.keyword.length>20?void r.error(t,"关键字不超过20个字！"):s.Notempty(t.commondity.summary)?t.commondity.summary.length>200?void r.error(t,"摘要不超过200个字！"):s.Notempty(t.commondity.author)?t.commondity.author.length>10?void r.error(t,"作者不超过10个字！"):""==t.commondity.authorurl||s.isUrl(t.commondity.authorurl)?""==t.commondity.arttype?void r.error(t,"请选择文章类型！"):t.commondity.outtime<=t.commondity.publishtime?void r.error(t,"过期时间应该大于发布时间！"):t.commondity.titleimageurl?void i({method:"POST",url:"/club/createAritle",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:$.param({article:JSON.stringify({title:t.commondity.title,keyword:t.commondity.keyword,summary:t.commondity.summary,author:t.commondity.author,authorurl:t.commondity.authorurl,arttype:t.commondity.arttype,publishtime:t.commondity.publishtime,outtime:t.commondity.outtime,content:t.commondity.content,istop:"0",ishot:"0",titleimageurl:t.commondity.titleimageurl})})}).success(function(e){s.check(e),e&&void 0!=e.data&&(e.error?r.error(t,"保存失败！"):e.data?(r.success(t,"保存成功！"),t.closeform(),t.query()):r.error(t,"保存失败！"))}).error(function(e){r.error(t,"保存失败！")}):void r.error(t,"请上传文章标题图片！"):void r.error(t,"原文地址请输入正确的URL！"):void r.error(t,"作者为必填项！"):void r.error(t,"摘要为必填项！"):void r.error(t,"关键字为必填项！"):void r.error(t,"标题为必填项！")},t.imgscan=function(){a.initImgUploader({browse_button:"pickfiles",uptoken_url:"/uploader/getarticletoken",domain:o.mall.articleimageurl,init:{FileUploaded:function(e,i,r){var n=JSON.parse(r);t.commondity.titleimageurl=n.key,$("#scanimg").attr({src:o.mall.articleimageurl+n.key+"-"+o.mall.articleimage60style}),t.$apply()}}})},t.initscan=function(){t.imgscan()},t.stopArticle=function(e){r.confirm({title:"提示？",content:"确定停用吗？",confirm:function(){i({method:"POST",url:"/club/delarticle",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:$.param({artid:e})}).success(function(e){s.check(e),e.error?r.error(t,"失败！"):0!=e.data.length&&t.query()}).error(function(e){r.error(t,"异常！")})}})},t.showEditArtcle=function(e){t.showEditForm=!0,i({method:"POST",url:"/club/getarticlebyid",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:$.param({artid:e.artid})}).success(function(t){if(s.check(t),t&&t.data){var e=t.data.content;$("#divedit").html(e)}}),t.commondity.artid=e.artid,t.commondity.title=e.title,t.commondity.keyword=e.keyword,t.commondity.summary=e.summary,t.commondity.author=e.author,t.commondity.authorurl=e.authorurl||"",t.commondity.arttype=e.arttype,t.commondity.publishtime=new Date(e.publishtime),t.commondity.outtime=new Date(e.outtime),t.configurl=o.mall.articleimageurl,t.configstyle=o.mall.articleimage60style,t.commondity.titleimageurl=e.titleimageurl},t.saveEdit=function(){return s.Notempty(t.commondity.title)?t.commondity.title.length>30?void r.error(t,"标题不超过30个字！"):s.Notempty(t.commondity.keyword)?t.commondity.keyword.length>20?void r.error(t,"关键字不超过20个字！"):s.Notempty(t.commondity.summary)?t.commondity.summary.length>200?void r.error(t,"摘要不超过200个字！"):s.Notempty(t.commondity.author)?t.commondity.author.length>10?void r.error(t,"作者不超过10个字！"):""==t.commondity.authorurl||s.isUrl(t.commondity.authorurl)?""==t.commondity.arttype?void r.error(t,"请选择文章类型！"):t.commondity.outtime<t.commondity.publishtime?void r.error(t,"过期时间应该大于发布时间！"):(console.log(t.commondity.titleimageurl),t.commondity.titleimageurl?void i({method:"POST",url:"/club/createAritle",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:$.param({article:JSON.stringify({artid:t.commondity.artid,title:t.commondity.title,keyword:t.commondity.keyword,summary:t.commondity.summary,author:t.commondity.author,authorurl:t.commondity.authorurl,arttype:t.commondity.arttype,publishtime:t.commondity.publishtime,outtime:t.commondity.outtime,content:t.commondity.content,istop:"0",ishot:"0",titleimageurl:t.commondity.titleimageurl})})}).success(function(e){s.check(e),e&&void 0!=e.data&&(console.log("request success"),e.error?r.error(t,"保存失败！"):e.data?(r.success(t,"保存成功！"),t.closeform(),t.query()):r.error(t,"保存失败！"))}):void r.error(t,"请上传文章标题图片！")):void r.error(t,"原文地址请输入正确的URL！"):void r.error(t,"作者为必填项！"):void r.error(t,"摘要为必填项！"):void r.error(t,"关键字为必填项！"):void r.error(t,"标题为必填项！")},t.scan=function(){t.scanphonebox=!0},t.closescan=function(){t.scanphonebox=!1},t.$on("goPage",function(e,i){t.query(i)})}]),window.APP.controller("mallManage",["$scope","$http",function(t,e){t.tableItems=[{name:"礼品管理",show:"showproduct"},{name:"订单管理",show:"showorder"},{name:"评价管理",show:"showeva"}],t.selectActivity=function(e){t.selectedItem=e,t.selectedshow=e.show},t.intpage=function(){t.selectedItem=t.tableItems[0],t.selectedshow="showproduct"}}]),window.APP.factory("MallProductService",["PostService",function(t){var e={};e.query=function(e){return e=$.extend(!0,{},e),e.query=JSON.stringify(e.query),t.request("/mall/pdtlist",$.param(e))},e.getProductInfo=function(e){return t.request("/mall/getproductinfo",$.param({productid:e}))},e.save=function(e){return e=$.extend(!0,{},e),e.productdetail.images=JSON.stringify(e.productdetail.images),t.request("/mall/updateMallProduct",$.param({productInfo:JSON.stringify(e)}))};var i=function(e,i){return t.request("/mall/updateMallProduct",$.param({productInfo:JSON.stringify({productid:e,state:i})}))};return e.shelve=function(t){return i(t,"sell")},e.offShelve=function(t){return i(t,"offshelf")},e}]),window.APP.controller("mallProductManage",["$scope","PaginationService","MessageService","UtilService","MallProductService","HostConfig","QiniuUploaderService",function(t,e,i,o,r,n,s){function a(){this.items=[],this.queryOptions={productor:"",point:"",page:1,size:5,categoryid:"",showpoint:!1,query:{productname:"",state:""}},this.pagination={page:1,size:5,total:0,pageCount:0,scope:t}}function c(t){this.productList=t,
this.showAddForm=!1,this.showEditForm=!1,this.imgItems=[],this.editorText="",this.defaultProduct={productid:"",productname:"",price:"",cost:"",amount:"",productinfo:"",productdetail:{htmlinfo:"",images:[]}},this.product=$.extend(!0,{},this.defaultProduct),this.errors={}}a.prototype.query=function(n){var s=this;o.startLoading(),s.queryOptions.page=n||s.queryOptions.page,r.query(s.queryOptions).then(function(t){s.items=t.data,s.pagination.page=t.page,s.pagination.total=t.totalsize,s.pagination.pageCount=t.totalpage,e.setContainer("#productTable").render(s.pagination)}).catch(function(e){i.error(t,"数据加载出错！")}).finally(function(){o.stopLoading()})},a.prototype.resetQuery=function(){this.queryOptions.query.productname="",this.queryOptions.query.state="",this.query(1)},a.prototype.shelve=function(e){o.startLoading(),r.shelve(e.productid).then(function(o){e.state="sell",i.success(t,"礼品上架成功！")}).catch(function(e){i.error(t,"礼品上架失败，请稍后尝试！")}).finally(function(){o.stopLoading()})},a.prototype.offShelve=function(e){i.confirm({title:"确定下架？",content:"确定下架礼品吗？下架后可以再次进行上架操作！",confirm:function(){o.startLoading(),r.offShelve(e.productid).then(function(o){e.state="offshelf",i.success(t,"礼品下架成功！")}).catch(function(o){e.state="offshelf",i.error(t,"礼品下架失败，请稍后尝试！")}).finally(function(){o.stopLoading()})}})},c.prototype.initEditor=function(){var t=this,e=new wangEditor("divedit"),i=["insertcode","fullscreen","location","video","emotion"];e.config.menus=$.map(wangEditor.config.menus,function(t,e){return-1!==i.indexOf(t)?null:t}),e.config.customUpload=!0,e.config.customUploadInit=function(){var t=this,e=t.customUploadBtnId;s.initImgUploader({browse_button:e,uptoken_url:"/uploader/getarticletoken",domain:n.mall.articleimageurl,init:{FileUploaded:function(e,i,o){var r=JSON.parse(o),n="http://om5zzdb7m.bkt.clouddn.com/"+r.key;t.command(null,"insertHtml",'<img src="'+n+'" style="max-width:100%;"/>')}}})},e.onchange=function(){t.editorText=this.$txt.text(),t.product.productdetail.htmlinfo=this.$txt.html()},e.create(),t.showEditForm&&(e.$txt.html(t.product.productdetail.htmlinfo),t.editorText=e.$txt.text())},c.prototype.initForm=function(){var e=this;s.initImgUploader({browse_button:"pickfiles",uptoken_url:"/uploader/getproducttoken",domain:n.mall.productimageurl,init:{FileUploaded:function(i,o,r){var n=JSON.parse(r),s=i.getOption("domain");e.imgItems.push({key:n.key,src:s+n.key}),t.$apply()}}}),e.initEditor()},c.prototype.showAdd=function(){this.showAddForm=!0},c.prototype.removeImg=function(t){var e=this.imgItems.indexOf(t);-1!=e&&this.imgItems.splice(e,1)},c.prototype.showEdit=function(e){var s=this;o.startLoading(),r.getProductInfo(e.productid).then(function(t){s.product.productid=t.baseinfo.productid,s.product.productname=t.baseinfo.productname,s.product.price=t.baseinfo.price,s.product.cost=t.baseinfo.cost,s.product.amount=t.baseinfo.amount,s.product.productinfo=t.baseinfo.productinfo,s.product.productdetail.htmlinfo=t.info.htmlinfo,s.product.productdetail.images=t.info.images,s.product.productimage=s.product.productdetail.images[0]||"";for(var e=s.product.productdetail.images,i=n.mall.productimageurl,o=0;o<e.length;o++)s.imgItems.push({key:e[o],src:i+e[o]});s.showEditForm=!0}).catch(function(e){i.error(t,"礼品详情获取失败，请稍后尝试！")}).finally(function(){o.stopLoading()})},c.prototype.validate=function(){this.errors={};var t=this.product;""==t.productname.trim()?this.errors.productname="礼品名称为必填项！":t.productname.length>100&&(this.errors.productname="礼品名称的最大长度为100！");var e=t.price;(isNaN(e)||0>=e||e%1!=0)&&(this.errors.price="请输入大于0的整数");var i=t.cost;(isNaN(i)||0>=i)&&(this.errors.cost="请输入大于0的数值");var o=t.amount;return(isNaN(o)||0>=o||o%1!=0)&&(this.errors.amount="请输入大于0的整数"),""==t.productinfo.trim()?this.errors.productinfo="礼品描述为必填项！":t.productinfo.length>200&&(this.errors.productinfo="礼品描述的最大长度为200"),0==t.productdetail.images.length?this.errors.images="请上传礼品详情轮播图！":t.productdetail.images.length>10&&(this.errors.images="礼品轮播图不超过10张图！"),angular.equals({},this.errors)},c.prototype.add=function(){var e=this;this.product.productdetail.images=[];for(var n=0;n<this.imgItems.length;n++)this.product.productdetail.images.push(this.imgItems[n].key);if(this.validate()){var s={productid:"",productname:this.product.productname,productimage:this.product.productdetail.images[0]||"",price:this.product.price,cost:this.product.cost.toFixed(2),amount:this.product.amount,productinfo:this.product.productinfo,productdetail:this.product.productdetail,state:"sell",producttype:"product",privilege:"0",leve:"5",spec:"1",mallcategoryCaid:"006",productdate:(new Date).toString()};o.startLoading(),r.save(s).then(function(o){i.success(t,"新增礼品成功！"),e.close(),e.productList.query()}).catch(function(o){e.errors.productname="礼品名称已被占用！",i.error(t,"新增礼品失败，请稍后重试！")}).finally(function(){o.stopLoading()})}},c.prototype.confirmAdd=function(){var e=this;i.confirm({title:"确定保存？",content:"确定保存吗？,保存之后礼品立刻上架！",confirm:function(){e.add(),t.$apply()}})},c.prototype.update=function(){var e=this;this.product.productdetail.images=[];for(var n=0;n<this.imgItems.length;n++)this.product.productdetail.images.push(this.imgItems[n].key);if(this.validate()){var s={productid:e.product.productid,productname:e.product.productname,price:e.product.price,cost:e.product.cost.toFixed(2),amount:e.product.amount,productinfo:e.product.productinfo,productdetail:e.product.productdetail,productimage:e.product.productdetail.images[0]||"",productdate:(new Date).toString()};o.startLoading(),r.save(s).then(function(o){i.success(t,"修改礼品成功！"),e.close(),e.productList.query()}).catch(function(o){e.errors.productname="礼品名称已被占用！",i.error(t,"修改礼品失败，请稍后重试！")}).finally(function(){o.stopLoading()})}},c.prototype.confirmUpdate=function(){var e=this;i.confirm({title:"确定保存？",content:"确定保存吗？",confirm:function(){e.update(),t.$apply()}})},c.prototype.close=function(){this.showAddForm=!1,this.showEditForm=!1,this.product=$.extend(!0,{},this.defaultProduct),this.imgItems=[],this.editorText="",this.errors={}},c.prototype.confirmClose=function(){var e=this;i.confirm({title:"确定取消？",content:"确定取消？尚未保存的修改将会丢失！",confirm:function(){e.close(),t.$apply()}})},t.productList=new a,t.productForm=new c(t.productList),t.productList.query(),t.$on("goPage",function(e,i){t.productList.query(i)})}]),window.APP.factory("MallOrderService",["PostService",function(t){var e={};return e.query=function(e){return t.request("/mall/getOrderList",$.param(e))},e.info=function(e){return t.request("/club/getOrderByid",$.param({orderid:e}))},e.sendGood=function(e){return t.request("/mall/updateOrder",$.param({orderInfo:JSON.stringify(e)}))},e.cancelOrder=function(e){return t.request("/mall/updateOrder",$.param({orderInfo:JSON.stringify({orderid:e,state:4})}))},e}]),window.APP.controller("mallOrderManage",["$scope","MallOrderService","MessageService","PaginationService","UtilService",function(t,e,i,o,r){function n(){this.items=[],this.selectedItems=[],this.queryOptions={page:1,size:5,begtime:"",endtime:"",orderbm:"",state:""},this.pagination={page:this.queryOptions.page,size:this.queryOptions.size,total:0,pageCount:0,scope:t}}function s(t){this.orderList=t,this.order=null,this.showForm=!1,this.express="",this.trackingno="",this.errors={}}function a(){this.show=!1,this.item=null,this.info=null}n.prototype.query=function(n){var s=this;r.startLoading(),s.queryOptions.page=n||s.queryOptions.page;var a=$.extend({},s.queryOptions),c=moment(a.begtime).format("YYYY-MM-DD"),u=moment(a.endtime).format("YYYY-MM-DD");a.begtime="Invalid date"==c?"":c,a.endtime="Invalid date"==u?"":u,e.query(a).then(function(t){s.items=t.data,s.pagination.page=t.page,s.pagination.total=t.totalsize,s.pagination.pageCount=t.totalpage,s.selectedItems=[],o.setContainer("#orderTable").render(s.pagination)}).catch(function(e){i.error(t,"数据加载出错！")}).finally(function(){r.stopLoading()})},n.prototype.resetQuery=function(){this.queryOptions.begtime="",this.queryOptions.endtime="",this.queryOptions.orderbm="",this.queryOptions.state="",this.query(1)},n.prototype.cancelOrder=function(o){var n=this;i.confirm({title:"确定撤销？",content:"确定撤销订单吗，撤销后无法恢复？",confirm:function(){r.startLoading(),e.cancelOrder(o.orderid).then(function(e){i.success(t,"订单撤销成功！"),n.query()}).catch(function(e){i.error(t,"订单撤销失败，请稍后重试！")}).finally(function(){r.stopLoading()})}})},s.prototype.show=function(t){this.order=t,this.showForm=!0},s.prototype.close=function(){this.order=null,this.showForm=!1},s.prototype.validate=function(){this.errors={},""==this.express&&(this.errors.express="请选择快递公司！");var t=this.trackingno.length;return""==this.trackingno.trim()?this.errors.trackingno="快递单号是必填项！":t<10||t>20?this.errors.trackingno="快递单号的长度为10 ~ 20位":/^[A-Za-z0-9]+$/.test(this.trackingno)||(this.errors.trackingno="请输入正确的快递单号格式！"),angular.equals(this.errors,{})},s.prototype.sendGood=function(){var o=this;if(o.validate()){r.startLoading();var n={orderid:o.order.orderid,state:2,express:o.express,trackingno:o.trackingno};e.sendGood(n).then(function(e){i.success(t,"订单发货成功！"),o.orderList.query(),o.close()}).catch(function(e){i.error(t,"订单发货失败，请稍后重试！")}).finally(function(){r.stopLoading()})}},a.prototype.showInfo=function(o){var n=this;r.startLoading(),e.info(o.orderid).then(function(t){n.show=!0,n.info=t,n.item=o}).catch(function(e){i.error(t,"订单详情获取失败，请稍后重试！")}).finally(function(){r.stopLoading()})},a.prototype.close=function(){this.show=!1,this.info=null,this.item=null},t.orderList=new n,t.expressForm=new s(t.orderList),t.orderInfo=new a,t.orderList.query(),t.$on("goPage",function(e,i){t.orderList.query(i)})}]),window.APP.controller("malladdManage",["$scope","$http",function(t,e){console.log("广告管理")}]),window.APP.factory("MallEvalService",["PostService",function(t){var e={};return e.query=function(e){return t.request("/mall/getproductevallist",$.param(e))},e.audit=function(e){return t.request("/mall/saveproducteval",$.param({eval:JSON.stringify(e)}))},e}]),window.APP.controller("mallevaManage",["$scope","PaginationService","MessageService","UtilService","MallEvalService",function(t,e,i,o,r){function n(){this.items=[],this.queryOptions={page:1,size:5,state:"",productname:"",key:"",sensitiveflag:""},this.pagination={page:this.queryOptions.page,size:this.queryOptions.size,total:0,pageCount:0,scope:t}}function s(t){this.evalList=t,this.eval=null,this.showForm=!1,this.state="1",this.remark="",this.errors={}}n.prototype.query=function(n){var s=this;o.startLoading(),s.queryOptions.page=n||s.queryOptions.page,r.query(s.queryOptions).then(function(t){s.items=t.data,s.pagination.page=s.queryOptions.page,s.pagination.total=t.totalsize,s.pagination.pageCount=t.totalpage,e.setContainer("#evalTable").render(s.pagination)}).catch(function(e){i.error(t,"数据加载出错！")}).finally(function(){o.stopLoading()})},n.prototype.resetQuery=function(){this.queryOptions.state="",this.queryOptions.productname="",this.queryOptions.key="",this.queryOptions.sensitiveflag="",this.query(1)},s.prototype.show=function(t){this.eval=t,this.state="0"==t.state?"1":t.state,this.showForm=!0},s.prototype.close=function(){this.eval=null,this.state="1",this.remark="",this.showForm=!1},s.prototype.validate=function(){return this.errors={},this.remark.length>50&&(this.errors.remark="备注的最大长度为50！"),angular.equals(this.errors,{})},s.prototype.audit=function(){var e=this;if(e.validate()){o.startLoading();var n={id:e.eval.id,state:e.state,remark:e.remark};r.audit(n).then(function(o){i.success(t,"评价审核成功！"),e.evalList.query(),e.close()}).catch(function(e){i.error(t,"评价审核失败，请稍后重试！")}).finally(function(){o.stopLoading()})}},t.evalList=new n,t.auditForm=new s(t.evalList),t.evalList.query(),t.$on("goPage",function(e,i){t.evalList.query(i)})}]),window.APP.controller("malllevelManage",["$scope","$http",function(t,e){console.log("客户星级规则管理")}]),window.APP.controller("mallmoduleManage",["$scope","$http",function(t,e){console.log("商城模块管理")}]),window.APP.controller("analysisMemberCtrl",["$scope","CommondityService","CommondityCategoryService","PaginationService","MessageService","PostService","UtilService","EchartPieService","MapChartService",function(t,e,i,o,r,n,s,a,c){function u(){this.defaultProductionCategoryQuery={page:1,size:100,query:{name:""}},this.defaultProductionQuery={page:1,size:100,query:{mcdname:"",batchcode:"",categoryid:""}},this.defaultQuery={areacode:"",categoryid:"",minpoint:"",maxpoint:"",page:1,size:5},this.pagination={page:1,size:10,total:0,pageCount:0,scope:t},this.categoryid="",this.mcdid="",this.productionCategoryList=[],this.productionList=[],this.memberList=[],this.memberTotal=0,this.provinceList=[],this.cityList=[],this.echartData=[],this.mapChartData=[],this.selectedProvince="",this.selectedCity=""}u.prototype.getMemberList=function(e){var i=this;if(i.minpoint&&i.maxpoint){if(i.minpoint%1!=0||i.maxpoint%1!=0||i.minpoint<0||i.maxpoint<0)return r.error(t,"积分输入错误，应为非负整数");if(i.minpoint>=i.maxpoint)return r.error(t,"积分输入错误，最低积分应小于最高积分")}var a={areacode:i.selectedCity||i.selectedProvince||i.defaultQuery.provinceCode,categoryid:i.categoryid||i.defaultQuery.productionId,minpoint:i.minpoint||i.defaultQuery.minpoint,maxpoint:i.maxpoint||i.defaultQuery.maxpoint,page:e||i.defaultQuery.page,size:i.defaultQuery.size};i.memberList=[],i.memberTotal=0,i.echartData=[],s.startLoading,n.request("/custanalysis/customernumbers",$.param(a)).then(function(r){i.memberList=r.data;for(var n=0;n<i.memberList.length;n++)i.memberTotal+=i.memberList[n].s_custid,i.echartData.push({value:i.memberList[n].s_custid,name:i.memberList[n].city||i.memberList[n].province});o.setContainer(".view-table").render({page:e||i.pagination.page,size:i.pagination.size,total:parseInt(i.memberList.length),pageCount:Math.ceil(parseInt(i.memberList.length)/i.pagination.size),scope:t}),i.refreshChart(i.echartData)}).catch(function(e){r.error(t,"会员人数信息获取失败，请稍后重试")}).finally(function(){s.stopLoading()})},u.prototype.refreshChart=function(t){a.refresh("memberChart","会员人数",t)},u.prototype.refreshMap=function(){var e=this;n.request("/custanalysis/customernumbers",$.param(e.defaultQuery)).then(function(t){for(var i=t.data,o=0;o<i.length;o++)e.mapChartData.push({name:i[o].city[0]+i[o].city[1],value:i[o].s_custid});c.refresh("mapChart","各省市会员数",e.mapChartData,"#f7f7f7")}).catch(function(e){r.error(t,"mapchart加载失败，请稍后重试")})},u.prototype.init=function(){var o=this;o.selectedProvince;o.memberList=[],i.query(o.defaultProductionCategoryQuery).then(function(t){o.productionCategoryList=t.data}).catch(function(e){r.error(t,"商品分类列表获取失败，请稍后重试")}),e.query(o.defaultProductionQuery).then(function(t){o.productionList=t.data}).catch(function(e){r.error(t,"商品列表获取失败，请稍后重试")}),n.request("/cities/query","").then(function(t){o.provinceList=t}).catch(function(e){r.error(t,"省份数据获取失败，请稍后尝试！")}),o.getMemberList(1),o.refreshMap()},t.memberList=new u,t.memberList.init(),t.$on("goPage",function(e,i){t.memberList.getMemberList(i)}),t.provinceChange=function(e){if(e){var i={parentCode:e};n.request("/cities/query",$.param(i)).then(function(e){t.memberList.cityList=e}).catch(function(e){r.error(t,"城市数据获取失败，请稍后尝试！")})}}}]),window.APP.controller("analysisOrderCtrl",["$scope","CommondityService","PaginationService","MessageService","PostService","UtilService","EchartPieService","MapChartService",function(t,e,i,o,r,n,s,a){function c(){this.defaultProductionQuery={productor:"",point:"",page:1,size:100,categoryid:"",showpoint:!1,query:{productname:"",state:""}},this.defaultQuery={productid:"",areacode:"",begtime:"",endtime:"",page:1,size:5},this.pagination={page:1,size:10,total:0,pageCount:0,scope:t},this.orderList=[],this.productionList=[],this.provinceList=[],this.cityList=[],this.selectedProvince="",this.selectedCity="",this.echartData=[],this.mapChartData=[],this.totalOrder=0,this.totalPoint=0}c.prototype.getOrderList=function(e){var s=this,a={productid:s.productid||s.defaultQuery.productid,areacode:s.selectedCity||s.selectedProvince||s.defaultQuery.areacode,begtime:s.defaultQuery.begtime,endtime:s.defaultQuery.endtime};if(s.defaultQuery.begtime>s.defaultQuery.endtime)return o.error(t,"时间设置错误，开始时间应晚于结束时间");s.orderList=[],s.totalOrder=0,s.totalPoint=0,s.echartData=[],n.startLoading,r.request("/analyze/ordersanalyze",$.param(a)).then(function(o){s.orderList=o.data;for(var r=0;r<s.orderList.length;r++)s.totalOrder+=s.orderList[r].s_order,s.totalPoint+=s.orderList[r].s_point,s.echartData.push({value:s.orderList[r].s_order,name:s.orderList[r].areacode>100?s.orderList[r].full.slice(4):s.orderList[r].full});i.setContainer(".view-table").render({page:e||s.pagination.page,size:s.pagination.size,total:parseInt(s.orderList.length),pageCount:Math.ceil(parseInt(s.orderList.length)/s.pagination.size),scope:t}),s.refreshChart(s.echartData)}).catch(function(e){o.error(t,"订单数据获取失败，请稍后重试")}).finally(function(){n.stopLoading()})},c.prototype.refreshChart=function(t){s.refresh("orderChart","地区订单数",t)},c.prototype.refreshMap=function(){var e=this;r.request("/analyze/ordersanalyze",$.param(e.defaultQuery)).then(function(t){for(var t=t.data,i=0;i<t.length;i++){var o=t[i].full.slice(4)[0]+t[i].full.slice(4)[1];e.mapChartData.push({name:o,value:t[i].s_order})}a.refresh("mapChart","各省市订单数",e.mapChartData,"#f7f7f7")}).catch(function(e){o.error(t,"mapchart加载失败，请稍后重试")})},c.prototype.init=function(){var e=this;e.memberList=[];e.selectedProvince;r.request("/mall/pdtlist",$.param(e.defaultProductionQuery)).then(function(t){e.productionList=t.data}).catch(function(e){o.error(t,"商品列表数据获取失败，请稍后尝试！")}),r.request("/cities/query","").then(function(t){e.provinceList=t}).catch(function(e){o.error(t,"省份数据获取失败，请稍后尝试！")}),e.getOrderList(1),e.refreshMap()},t.orderList=new c,t.orderList.init(),t.$on("goPage",function(e,i){t.orderList.getOrderList(i)}),t.provinceChange=function(e){var i={parentCode:e};r.request("/cities/query",$.param(i)).then(function(e){t.orderList.cityList=e}).catch(function(e){o.error(t,"城市数据获取失败，请稍后尝试！")})}}]),window.APP.controller("analysisPointCtrl",["$scope","CommondityService","CommondityCategoryService","PaginationService","MessageService","PostService","UtilService","EchartPieService","BarChartService",function(t,e,i,o,r,n,s,a,c){function u(){this.defaultProductionCategoryQuery={page:1,size:100,query:{name:""}},this.defaultProductionQuery={page:1,size:100,query:{mcdname:"",batchcode:"",categoryid:""}},this.defaultQuery={},this.categoryid="",this.mcdid="",this.productionCategoryList=[],this.productionList=[],this.pointList=[],this.pointTotal=0,this.pointNew=0,this.provinceList=[],this.cityList=[],this.pieData=[],this.lineData=[],this.barData=[],this.selectedProvince=51,this.selectedCity=""}u.prototype.getPointList=function(){var e=this;if(e.defaultQuery.begtime>=e.defaultQuery.endtime)return r.error(t,"起始时间不能晚于结束时间")},u.prototype.refreshPie=function(t){a.refresh("pie-chart","所选时间段积分分布",t)},u.prototype.refreshLine=function(t){c.refreshLine("line-chart","产生积分走势图")},u.prototype.refreshBar=function(t){c.refreshBar("bar-chart","积分分析图")},u.prototype.init=function(){var o=this;o.selectedProvince;o.memberList=[],i.query(o.defaultProductionCategoryQuery).then(function(t){o.productionCategoryList=t.data}).catch(function(e){r.error(t,"商品分类列表获取失败，请稍后重试")}),e.query(o.defaultProductionQuery).then(function(t){o.productionList=t.data}).catch(function(e){r.error(t,"商品列表获取失败，请稍后重试")}),n.request("/cities/query","").then(function(t){o.provinceList=t}).catch(function(e){r.error(t,"省份数据获取失败，请稍后尝试！")}),n.request("/cities/query",$.param({parentCode:o.selectedProvince})).then(function(t){o.cityList=t}).catch(function(e){r.error(t,"城市数据获取失败，请稍后尝试！")}),o.refreshBar(),o.refreshLine(),o.refreshPie([{value:400,name:"消耗积分"},{value:450,name:"产生积分"}])},t.pointList=new u,t.pointList.init(),t.productionChange=function(e){t.pointList.categoryid=e},t.provinceChange=function(e){t.pointList.selectedProvince=e;var i={parentCode:e};n.request("/cities/query",$.param(i)).then(function(e){t.pointList.cityList=e}).catch(function(e){r.error(t,"城市数据获取失败，请稍后尝试！")})},t.cityChange=function(e){t.pointList.selectedCity=e}}]),window.APP.controller("activityCtrl",["$scope","$http","MessageService","ValiService",function(t,e,i,o){t.items=[{title:"活动进度分析",src:"views/templates/analysis/activity.progress.html"},{title:"活动效果分析",src:"views/templates/analysis/activity.effctive.html"}],t.queryCondition={begtime:"",endtime:"",quarter:""};var r=function(){e({method:"POST",url:"/project/list",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:$.param({query:JSON.stringify({begdate:"",enddate:"",key:"",state:"",type:""}),page:1,size:100})}).success(function(e){o.check(e),e.data&&e.data.data?t.tableItems=e.data.data:e.error&&i.error(t,"查询失败！"+e.error.message)}).error(function(e){i.error(t,"查询失败！")})};r(),t.query=function(){r()},t.selectActivity=function(e){t.selectedItem=e,t.$broadcast("actitems",e)}}]),window.APP.controller("activityProgressCtrl",["$scope","$http","MessageService","ValiService",function(t,e,i,o){var r=new Date;r.setMonth(0),r.setDate(1);var n=new Date;n.setDate(n.getDate()+1),t.progress={projectid:"",method:"m",begtime:r,endtime:n},t.$on("actitems",function(e,i){var o=i.projectid;window.sessionStorage.setItem("piid",o),t.progress.projectid=o,t.drawpic()}),t.initpro=function(){t.progress.projectid=window.sessionStorage.getItem("piid"),t.drawpic()},t.drawpic=function(r){function n(t){var e=t.getFullYear(),i=t.getMonth()+1;i=i<10?"0"+i:i;var o=t.getDate();o=o<10?"0"+o:o;var r=(t.getHours(),t.getMinutes());return r=r<10?"0"+r:r,e+"-"+i+"-"+o}$("#main").empty(),t.progress.projectid?e({method:"POST",url:"/analyze/projprogress",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:$.param({projectid:t.progress.projectid,method:t.progress.method,begtime:n(t.progress.begtime),endtime:n(t.progress.endtime)})}).success(function(t){if(o.check(t),t.data){var e=t.data;if(0==e.length)return void $("#main").html('<p class="picinfo">没有数据可以查询！</p>');for(var i=[],r=[],n=[],s={},a=0;a<e.length;a++){i.push(e[a].date),n[a]=[];for(var c in e[a])"date"!=c&&n[a].push(e[a][c]);s[i[a]]=n[a]}for(var c in e[0])"date"!=c&&r.push(c);var u=echarts.init(document.getElementById("main"));({}).dataGDP=s;for(var d=[],l=0;l<i.length;l++){var m={title:{text:i[l]+"全国扫码次数分布"},series:[{data:s[i[l]]}]};d.push(m)}option={baseOption:{title:{left:"center"},timeline:{axisType:"category",autoPlay:!1,playInterval:1e3,data:i},tooltip:{},calculable:!0,grid:{top:80,bottom:100},xAxis:[{type:"category",axisLabel:{interval:0},data:r,splitLine:{show:!1}}],yAxis:[{type:"value",name:"个"}],series:[{name:"活动进度",type:"bar",barMaxWidth:40}]},options:d},u.setOption(option)}}).error(function(e){i.error(t,"查询失败！")}):$("#main").html('<p class="picinfo">请在左侧选择活动！</p>')}}]),window.APP.controller("activityeffctiveCtrl",["$scope","$http","MessageService","ValiService",function(t,e,i,o){var r=new Date;r.setMonth(0),r.setDate(1);var n=new Date;n.setDate(n.getDate()+1),t.effctive={projectid:"",begtime:r,endtime:n},t.$on("actitems",function(e,i){var o=i.projectid;t.effctive.projectid=o,window.sessionStorage.setItem("piid",o),t.draweffec()}),t.initeffective=function(){t.effctive.projectid=window.sessionStorage.getItem("piid"),t.draweffec()},t.draweffec=function(r){function n(t){var e=t.getFullYear(),i=t.getMonth()+1;i=i<10?"0"+i:i;var o=t.getDate();o=o<10?"0"+o:o;var r=(t.getHours(),t.getMinutes());return r=r<10?"0"+r:r,e+"-"+i+"-"+o}$("#main").empty(),t.effctive.projectid?e({method:"POST",url:"/analyze/projeffect",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:$.param({projectid:t.effctive.projectid,begtime:n(t.effctive.begtime),endtime:n(t.effctive.endtime)})}).success(function(t){if(o.check(t),t.data){var e=t.data;if(0==e.length)return void $("#main").html('<p class="picinfo">没有数据可以查询！</p>');for(var i=echarts.init(document.getElementById("main")),r=[],n=[],s=0;s<e.length;s++)r.push(e[s].name),n.push(e[s].scancounts);for(var a=[],c=0;c<e.length;c++){var u={value:n[c],name:r[c]};a.push(u)}var i=echarts.init(document.getElementById("main"));option={title:{text:"活动效果分析",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:r},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],data:a,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},i.setOption(option)}}).error(function(e){i.error(t,"查询失败！")}):$("#main").html('<p class="picinfo">请在左侧选择活动！</p>')}}]);